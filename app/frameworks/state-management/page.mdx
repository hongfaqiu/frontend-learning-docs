import { Callout } from 'nextra/components'

# 10. çŠ¶æ€ç®¡ç†æ·±å…¥

## ğŸ“‹ ç›®å½•

- [çŠ¶æ€ç®¡ç†æ¦‚å¿µå’Œæ¨¡å¼](#çŠ¶æ€ç®¡ç†æ¦‚å¿µå’Œæ¨¡å¼)
- [Reduxç”Ÿæ€ç³»ç»Ÿ](#reduxç”Ÿæ€ç³»ç»Ÿ)
- [ç°ä»£çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ](#ç°ä»£çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ)
- [çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”](#çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”)
- [æœ€ä½³å®è·µå’Œé€‰æ‹©æŒ‡å—](#æœ€ä½³å®è·µå’Œé€‰æ‹©æŒ‡å—)
- [æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†](#æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†)

## çŠ¶æ€ç®¡ç†æ¦‚å¿µå’Œæ¨¡å¼

<Callout type="info">
çŠ¶æ€ç®¡ç†æ˜¯ç°ä»£å‰ç«¯åº”ç”¨çš„æ ¸å¿ƒé—®é¢˜ï¼Œé€‰æ‹©åˆé€‚çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆèƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œåº”ç”¨æ€§èƒ½ã€‚
</Callout>

### çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µ

#### çŠ¶æ€åˆ†ç±»

| çŠ¶æ€ç±»å‹ | ä½œç”¨åŸŸ | ç¤ºä¾‹ | ç®¡ç†æ–¹å¼ |
|----------|--------|------|----------|
| **æœ¬åœ°çŠ¶æ€** | ç»„ä»¶å†…éƒ¨ | è¡¨å•æ•°æ®ã€æ¨¡æ€æ¡†çŠ¶æ€ | useState, useReducer |
| **å…¨å±€çŠ¶æ€** | åº”ç”¨çº§åˆ« | ç”¨æˆ·ä¿¡æ¯ã€ä¸»é¢˜è®¾ç½® | Redux, Zustand, Context |
| **æœåŠ¡ç«¯çŠ¶æ€** | è¿œç¨‹æ•°æ® | APIæ•°æ®ã€ç¼“å­˜ | React Query, SWR |
| **URLçŠ¶æ€** | è·¯ç”±ç›¸å…³ | é¡µé¢å‚æ•°ã€æŸ¥è¯¢æ¡ä»¶ | React Router, Next.js |

#### çŠ¶æ€ç®¡ç†æŒ‘æˆ˜

| æŒ‘æˆ˜ | é—®é¢˜æè¿° | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| **çŠ¶æ€åŒæ­¥** | å¤šç»„ä»¶å…±äº«çŠ¶æ€ | å…¨å±€çŠ¶æ€ç®¡ç† |
| **çŠ¶æ€æŒä¹…åŒ–** | é¡µé¢åˆ·æ–°åä¿æŒçŠ¶æ€ | localStorage, sessionStorage |
| **çŠ¶æ€é¢„æµ‹æ€§** | çŠ¶æ€å˜åŒ–å¯è¿½è¸ª | ä¸å¯å˜æ›´æ–°ã€æ—¶é—´æ—…è¡Œè°ƒè¯• |
| **æ€§èƒ½ä¼˜åŒ–** | é¿å…ä¸å¿…è¦é‡æ¸²æŸ“ | é€‰æ‹©å™¨ã€è®°å¿†åŒ– |
| **å¼€å‘ä½“éªŒ** | è°ƒè¯•å’Œå¼€å‘å·¥å…· | DevToolsã€ç±»å‹å®‰å…¨ |

#### å•å‘æ•°æ®æµæ¨¡å¼

```
Action â†’ Dispatcher â†’ Store â†’ View â†’ Action
```

è¿™æ˜¯ç°ä»£çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒæ¨¡å¼ï¼Œç¡®ä¿æ•°æ®æµå‘å¯é¢„æµ‹ã€‚

### çŠ¶æ€ç®¡ç†æ¨¡å¼

#### å¸¸è§çŠ¶æ€ç®¡ç†æ¨¡å¼

| æ¨¡å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä»£è¡¨æ–¹æ¡ˆ |
|------|------|----------|----------|
| **Fluxæ¨¡å¼** | å•å‘æ•°æ®æµï¼Œå¯é¢„æµ‹ | å¤æ‚åº”ç”¨çŠ¶æ€ç®¡ç† | Redux, Zustand |
| **Observeræ¨¡å¼** | è§‚å¯Ÿè€…è®¢é˜…çŠ¶æ€å˜åŒ– | å“åº”å¼æ›´æ–° | MobX, Vue |
| **å‘å¸ƒè®¢é˜…æ¨¡å¼** | äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€æ›´æ–° | æ¾è€¦åˆç»„ä»¶é€šä¿¡ | EventBus |
| **åŸå­åŒ–æ¨¡å¼** | çŠ¶æ€æ‹†åˆ†ä¸ºæœ€å°å•ä½ | ç»†ç²’åº¦çŠ¶æ€ç®¡ç† | Jotai, Recoil |

#### ç®€åŒ–çš„çŠ¶æ€ç®¡ç†å®ç°

```javascript
// ç®€å•çš„çŠ¶æ€ç®¡ç†å™¨
class SimpleStateManager {
  constructor(initialState = {}) {
    this.state = initialState;
    this.listeners = [];
  }

  getState() {
    return this.state;
  }

  setState(updates) {
    this.state = { ...this.state, ...updates };
    this.listeners.forEach(listener => listener(this.state));
  }

  subscribe(listener) {
    this.listeners.push(listener);
    return () => {
      this.listeners = this.listeners.filter(l => l !== listener);
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const store = new SimpleStateManager({ count: 0 });

store.subscribe((state) => {
  console.log('State updated:', state);
});

store.setState({ count: 1 }); // è§¦å‘æ›´æ–°
```

## Reduxç”Ÿæ€ç³»ç»Ÿ

### Redux Toolkitç°ä»£åŒ–å®è·µ

<Callout type="warning">
Redux Toolkitæ˜¯Reduxå®˜æ–¹æ¨èçš„ç°ä»£åŒ–å·¥å…·é›†ï¼Œå¤§å¤§ç®€åŒ–äº†Reduxçš„ä½¿ç”¨å¤æ‚åº¦ã€‚
</Callout>

#### Redux Toolkitæ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | ä¼˜åŠ¿ |
|------|------|------|
| **createSlice** | è‡ªåŠ¨ç”Ÿæˆactionså’Œreducers | å‡å°‘æ ·æ¿ä»£ç  |
| **createAsyncThunk** | å¤„ç†å¼‚æ­¥é€»è¾‘ | ç»Ÿä¸€å¼‚æ­¥çŠ¶æ€ç®¡ç† |
| **Immeré›†æˆ** | æ”¯æŒ"å¯å˜"æ›´æ–°è¯­æ³• | ç®€åŒ–çŠ¶æ€æ›´æ–° |
| **RTK Query** | æ•°æ®è·å–å’Œç¼“å­˜ | æ›¿ä»£æ‰‹å†™APIé€»è¾‘ |

#### ç®€åŒ–çš„Redux Toolkitç¤ºä¾‹

```javascript
// 1. åˆ›å»ºçŠ¶æ€åˆ‡ç‰‡
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

// å¼‚æ­¥thunk
export const fetchUsers = createAsyncThunk(
  'users/fetchUsers',
  async (params) => {
    const response = await fetch(`/api/users?${new URLSearchParams(params)}`);
    return response.json();
  }
);

// çŠ¶æ€åˆ‡ç‰‡
const usersSlice = createSlice({
  name: 'users',
  initialState: {
    items: [],
    loading: false,
    error: null
  },
  reducers: {
    clearError: (state) => {
      state.error = null;
    }
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchUsers.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchUsers.fulfilled, (state, action) => {
        state.loading = false;
        state.items = action.payload;
      })
      .addCase(fetchUsers.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      });
  }
});

export const { clearError } = usersSlice.actions;
export default usersSlice.reducer;
```

#### Redux Toolkitæœ€ä½³å®è·µ

| å®è·µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **çŠ¶æ€è§„èŒƒåŒ–** | ä½¿ç”¨æ‰å¹³åŒ–ç»“æ„å­˜å‚¨æ•°æ® | `{ byId: {}, allIds: [] }` |
| **é€‰æ‹©å™¨å¤ç”¨** | ä½¿ç”¨createSelectoråˆ›å»ºè®°å¿†åŒ–é€‰æ‹©å™¨ | `selectFilteredUsers` |
| **å¼‚æ­¥å¤„ç†** | ä½¿ç”¨createAsyncThunkå¤„ç†å¼‚æ­¥é€»è¾‘ | APIè°ƒç”¨ã€æ•°æ®è·å– |
| **ä¸­é—´ä»¶é…ç½®** | åˆç†é…ç½®å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­é—´ä»¶ | loggerã€devTools |

#### Storeé…ç½®ç¤ºä¾‹

```javascript
// å®Œæ•´çš„storeé…ç½®
import { configureStore } from '@reduxjs/toolkit';
import { persistStore, persistReducer } from 'redux-persist';

const store = configureStore({
  reducer: {
    users: usersReducer,
    auth: authReducer,
    settings: settingsReducer
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: ['persist/PERSIST', 'persist/REHYDRATE']
      }
    }),
  devTools: process.env.NODE_ENV !== 'production'
});

const errorMiddleware = (store) => (next) => (action) => {
  try {
    return next(action);
  } catch (error) {
    console.error('Redux error:', error);
    // å¯ä»¥å‘é€é”™è¯¯åˆ°ç›‘æ§æœåŠ¡
    throw error;
  }
};

// 5. Reactç»„ä»¶ä¸­ä½¿ç”¨
import React, { useEffect } from 'react';
import { useSelector, useDispatch } from 'react-redux';

function UserList() {
  const dispatch = useDispatch();
  const users = useSelector(selectFilteredUsers);
  const loading = useSelector(selectUsersLoading);
  const error = useSelector(selectUsersError);
  const filters = useSelector(selectUsersFilters);
  const pagination = useSelector(selectUsersPagination);
  const stats = useSelector(selectUsersStats);
  
  useEffect(() => {
    dispatch(fetchUsers({ 
      page: pagination.page, 
      limit: pagination.limit,
      ...filters 
    }));
  }, [dispatch, pagination.page, pagination.limit, filters]);
  
  const handleFilterChange = (newFilters) => {
    dispatch(setFilters(newFilters));
  };
  
  const handlePageChange = (page) => {
    dispatch(setPagination({ page }));
  };
  
  const handleCreateUser = (userData) => {
    dispatch(createUser(userData));
  };
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  
  return (
    <div>
      <UserStats stats={stats} />
      <UserFilters filters={filters} onChange={handleFilterChange} />
      <UserTable users={users} />
      <Pagination 
        current={pagination.page}
        total={pagination.total}
        pageSize={pagination.limit}
        onChange={handlePageChange}
      />
    </div>
  );
}
```

## ç°ä»£çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

### Zustand - è½»é‡çº§çŠ¶æ€ç®¡ç†

#### Zustandæ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | ä¼˜åŠ¿ |
|------|------|------|
| **è½»é‡çº§** | åŒ…ä½“ç§¯å°ï¼ŒAPIç®€æ´ | å­¦ä¹ æˆæœ¬ä½ï¼Œæ€§èƒ½å¥½ |
| **TypeScriptå‹å¥½** | åŸç”ŸTypeScriptæ”¯æŒ | ç±»å‹å®‰å…¨ï¼Œå¼€å‘ä½“éªŒå¥½ |
| **ä¸­é—´ä»¶ä¸°å¯Œ** | persistã€devtoolsã€immerç­‰ | åŠŸèƒ½æ‰©å±•çµæ´» |
| **æ— æ ·æ¿ä»£ç ** | ä¸éœ€è¦providerså’Œreducers | ä»£ç ç®€æ´ |

#### åŸºç¡€ç”¨æ³•ç¤ºä¾‹

```javascript
// 1. åˆ›å»ºç®€å•store
import { create } from 'zustand';

const useUserStore = create((set, get) => ({
  // çŠ¶æ€
  users: [],
  loading: false,

  // åŠ¨ä½œ
  addUser: (user) => set((state) => ({
    users: [...state.users, user]
  })),

  removeUser: (id) => set((state) => ({
    users: state.users.filter(u => u.id !== id)
  })),

  // å¼‚æ­¥åŠ¨ä½œ
  fetchUsers: async () => {
    set({ loading: true });
    try {
      const response = await fetch('/api/users');
      const users = await response.json();
      set({ users, loading: false });
    } catch (error) {
      set({ loading: false });
    }
  }
}));
```

#### ä¸­é—´ä»¶ä½¿ç”¨

```javascript
// 2. ä½¿ç”¨ä¸­é—´ä»¶å¢å¼ºstore
import { create } from 'zustand';
import { devtools, persist } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

const useUserStore = create()(
  devtools(
    persist(
      immer((set) => ({
        users: [],
        addUser: (user) => set((state) => {
          state.users.push(user); // ä½¿ç”¨immerå¯ä»¥ç›´æ¥"ä¿®æ”¹"
        }),
        setFilters: (filters) => set((state) => {
          Object.assign(state.filters, filters);
        })
      })),
      { name: 'user-store' } // æŒä¹…åŒ–é…ç½®
    ),
    { name: 'user-store' } // devtoolsé…ç½®
  )
);
```

#### åˆ†ç‰‡storeæ¨¡å¼

```javascript
// 3. å¤§å‹åº”ç”¨çš„åˆ†ç‰‡æ¨¡å¼
const createUserSlice = (set, get) => ({
  users: [],
  addUser: (user) => set((state) => ({ users: [...state.users, user] }))
});

const createAuthSlice = (set, get) => ({
  user: null,
  login: async (credentials) => {
    const response = await fetch('/api/login', {
      method: 'POST',
      body: JSON.stringify(credentials)
    });
    const { user, token } = await response.json();
    set({ user, token });
  }
});

const useAppStore = create()(
  devtools((...args) => ({
    ...createUserSlice(...args),
    ...createAuthSlice(...args)
  }))
);
```

#### ç»„ä»¶ä¸­ä½¿ç”¨

```javascript
// 4. åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨
import { useShallow } from 'zustand/react/shallow';

function UserComponent() {
  // é€‰æ‹©ç‰¹å®šçŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
  const { users, addUser } = useUserStore(
    useShallow((state) => ({
      users: state.users,
      addUser: state.addUser
    }))
  );

  return (
    <div>
      {users.map(user => (
        <div key={user.id}>{user.name}</div>
      ))}
      <button onClick={() => addUser({ id: Date.now(), name: 'New User' })}>
        Add User
      </button>
    </div>
  );
}
    }))
  );
  
  // è®¢é˜…ç‰¹å®šçŠ¶æ€å˜åŒ–
  useEffect(() => {
    const unsubscribe = useUserStore.subscribe(
      (state) => state.users.length,
      (userCount) => {
        console.log('ç”¨æˆ·æ•°é‡å˜åŒ–:', userCount);
      }
    );
    
    return unsubscribe;
  }, []);
  
  return (
    <div>
      {users.map(user => (
        <UserCard 
          key={user.id} 
          user={user} 
          onRemove={() => removeUser(user.id)}
        />
      ))}
    </div>
  );
}
```

### Jotai - åŸå­åŒ–çŠ¶æ€ç®¡ç†

#### Jotaiæ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ | ç‰¹ç‚¹ |
|------|------|------|
| **Atom** | çŠ¶æ€çš„æœ€å°å•ä½ | å¯è¯»å¯å†™ï¼Œè‡ªåŠ¨ä¾èµ–è¿½è¸ª |
| **Derived Atom** | æ´¾ç”ŸçŠ¶æ€ | åŸºäºå…¶ä»–atomè®¡ç®—å¾—å‡º |
| **Write-only Atom** | åªå†™åŸå­ | ç”¨äºå¤„ç†å‰¯ä½œç”¨å’Œå¼‚æ­¥æ“ä½œ |
| **Provider** | çŠ¶æ€ä½œç”¨åŸŸ | å¯é€‰ï¼Œç”¨äºéš”ç¦»çŠ¶æ€ |

#### åŸºç¡€ç”¨æ³•ç¤ºä¾‹

```javascript
// 1. å®šä¹‰åŸå­
import { atom } from 'jotai';

// åŸºç¡€åŸå­
export const usersAtom = atom([]);
export const loadingAtom = atom(false);
export const searchAtom = atom('');

// æ´¾ç”ŸåŸå­
export const filteredUsersAtom = atom((get) => {
  const users = get(usersAtom);
  const search = get(searchAtom);

  return users.filter(user =>
    user.name.toLowerCase().includes(search.toLowerCase())
  );
});

// å¼‚æ­¥åŸå­
export const fetchUsersAtom = atom(
  null, // è¯»å–å€¼ï¼ˆä¸ä½¿ç”¨ï¼‰
  async (get, set) => { // å†™å…¥å‡½æ•°
    set(loadingAtom, true);
    try {
      const response = await fetch('/api/users');
      const users = await response.json();
      set(usersAtom, users);
    } finally {
      set(loadingAtom, false);
    }
  }
);
```

#### ç»„ä»¶ä¸­ä½¿ç”¨

```javascript
// 2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨åŸå­
import { useAtom, useAtomValue, useSetAtom } from 'jotai';

function UserList() {
  // åªè¯»å–å€¼
  const filteredUsers = useAtomValue(filteredUsersAtom);
  const loading = useAtomValue(loadingAtom);

  // åªè®¾ç½®å€¼
  const fetchUsers = useSetAtom(fetchUsersAtom);

  // è¯»å–å’Œè®¾ç½®
  const [search, setSearch] = useAtom(searchAtom);

  useEffect(() => {
    fetchUsers();
  }, [fetchUsers]);

  return (
    <div>
      <input
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        placeholder="æœç´¢ç”¨æˆ·..."
      />
      {loading ? (
        <div>Loading...</div>
      ) : (
        filteredUsers.map(user => (
          <div key={user.id}>{user.name}</div>
        ))
      )}
    </div>
  );
}
```

#### é«˜çº§ç‰¹æ€§

```javascript
// 3. æŒä¹…åŒ–å’Œå·¥å…·å‡½æ•°
import { atomWithStorage, RESET } from 'jotai/utils';

// æŒä¹…åŒ–åŸå­
export const themeAtom = atomWithStorage('theme', 'light');

// é‡ç½®åŸå­
export const resetUsersAtom = atom(null, (get, set) => {
  set(usersAtom, RESET);
  set(searchAtom, RESET);
});
```

#### Jotai vs å…¶ä»–æ–¹æ¡ˆ

| ç‰¹æ€§ | Jotai | Zustand | Redux |
|------|-------|---------|-------|
| **å¿ƒæ™ºæ¨¡å‹** | åŸå­åŒ– | å•ä¸€store | å•ä¸€store |
| **æ ·æ¿ä»£ç ** | æœ€å°‘ | å°‘ | å¤š |
| **æ€§èƒ½** | ä¼˜ç§€ | ä¼˜ç§€ | è‰¯å¥½ |
| **é€‚ç”¨åœºæ™¯** | å¤æ‚çŠ¶æ€ä¾èµ– | ç®€å•å…¨å±€çŠ¶æ€ | å¤§å‹åº”ç”¨ |

## çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆé€‰æ‹©çŸ©é˜µ

| ç‰¹æ€§ | Redux Toolkit | Zustand | Jotai | Context API | Valtio |
|------|---------------|---------|-------|-------------|--------|
| **å­¦ä¹ æ›²çº¿** | ä¸­ç­‰ | ç®€å• | ä¸­ç­‰ | ç®€å• | ç®€å• |
| **åŒ…å¤§å°** | å¤§ | å° | å° | æ—  | å° |
| **TypeScriptæ”¯æŒ** | ä¼˜ç§€ | ä¼˜ç§€ | ä¼˜ç§€ | è‰¯å¥½ | ä¼˜ç§€ |
| **å¼€å‘å·¥å…·** | ä¼˜ç§€ | è‰¯å¥½ | è‰¯å¥½ | æ—  | è‰¯å¥½ |
| **æ€§èƒ½** | è‰¯å¥½ | ä¼˜ç§€ | ä¼˜ç§€ | å·® | ä¼˜ç§€ |
| **ç”Ÿæ€ç³»ç»Ÿ** | ä¸°å¯Œ | ä¸­ç­‰ | ä¸­ç­‰ | ä¸°å¯Œ | å° |
| **é€‚ç”¨åœºæ™¯** | å¤§å‹åº”ç”¨ | ä¸­å°å‹åº”ç”¨ | å¤æ‚çŠ¶æ€ | ç®€å•çŠ¶æ€ | å“åº”å¼åº”ç”¨ |

### é€‰æ‹©æŒ‡å—

#### åŸºäºåº”ç”¨è§„æ¨¡çš„é€‰æ‹©

| åº”ç”¨è§„æ¨¡ | æ¨èæ–¹æ¡ˆ | ç†ç”± | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|----------|
| **å°å‹** | useState + useContext | ç®€å•å¤Ÿç”¨ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ– | ä¸ªäººé¡¹ç›®ã€åŸå‹å¼€å‘ |
| **ä¸­å‹** | Zustand | è½»é‡çº§ï¼Œæ˜“äºä½¿ç”¨ï¼Œæ€§èƒ½è‰¯å¥½ | åˆåˆ›å…¬å¸ã€ä¸­å°å›¢é˜Ÿ |
| **å¤§å‹** | Redux Toolkit | æˆç†Ÿç”Ÿæ€ï¼Œå¼ºå¤§å¼€å‘å·¥å…· | ä¼ä¸šçº§åº”ç”¨ã€å¤§å›¢é˜Ÿ |

#### åŸºäºå›¢é˜Ÿç»éªŒçš„é€‰æ‹©

| å›¢é˜Ÿç»éªŒ | æ¨èæ–¹æ¡ˆ | å­¦ä¹ æˆæœ¬ | ä¸Šæ‰‹æ—¶é—´ |
|----------|----------|----------|----------|
| **åˆçº§** | Zustand | ä½ | 1-2å¤© |
| **ä¸­çº§** | Jotai æˆ– Zustand | ä¸­ç­‰ | 3-5å¤© |
| **é«˜çº§** | Redux Toolkit | é«˜ | 1-2å‘¨ |

#### åŸºäºæ€§èƒ½è¦æ±‚çš„é€‰æ‹©

| æ€§èƒ½è¦æ±‚ | æ¨èæ–¹æ¡ˆ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|----------|
| **ä¸€èˆ¬** | ä»»ä½•æ–¹æ¡ˆ | æ»¡è¶³åŸºæœ¬éœ€æ±‚ | å¸¸è§„ä¸šåŠ¡åº”ç”¨ |
| **é«˜æ€§èƒ½** | Jotai æˆ– Valtio | ç»†ç²’åº¦æ›´æ–°ï¼Œç²¾ç¡®æ§åˆ¶é‡æ¸²æŸ“ | æ•°æ®å¯†é›†å‹åº”ç”¨ |

#### å¿«é€Ÿå†³ç­–æŒ‡å—

**é€‰æ‹©æµç¨‹**ï¼š
1. **é¡¹ç›®è§„æ¨¡å°** â†’ useState + useContext
2. **å›¢é˜Ÿæ–°æ‰‹å¤š** â†’ Zustand
3. **éœ€è¦é«˜æ€§èƒ½** â†’ Jotai
4. **å¤§å‹ä¼ä¸šé¡¹ç›®** â†’ Redux Toolkit
5. **ä¸ç¡®å®šæ—¶** â†’ Zustandï¼ˆå¹³è¡¡é€‰æ‹©ï¼‰

## æœ€ä½³å®è·µå’Œé€‰æ‹©æŒ‡å—

<Callout type="info">
é€‰æ‹©çŠ¶æ€ç®¡ç†æ–¹æ¡ˆéœ€è¦è€ƒè™‘åº”ç”¨è§„æ¨¡ã€å›¢é˜Ÿç»éªŒã€æ€§èƒ½è¦æ±‚ç­‰å¤šä¸ªç»´åº¦ã€‚
</Callout>

### é€‰æ‹©å†³ç­–æ ‘

#### åŸºäºå›¢é˜Ÿå’Œé¡¹ç›®ç‰¹å¾çš„é€‰æ‹©

| é¡¹ç›®ç‰¹å¾ | å›¢é˜Ÿè§„æ¨¡ | æ¨èæ–¹æ¡ˆ | å¤‡é€‰æ–¹æ¡ˆ |
|----------|----------|----------|----------|
| **ç®€å•åº”ç”¨** | â‰¤3äºº | useState + useContext | Zustand |
| **ä¸­å‹åº”ç”¨** | 4-10äºº | Zustand | Jotai, Valtio |
| **å¤æ‚åº”ç”¨** | >10äºº | Redux Toolkit | MobX |
| **é«˜æ€§èƒ½è¦æ±‚** | ä»»æ„ | Jotai, Valtio | MobX |

### æœ€ä½³å®è·µåŸåˆ™

#### çŠ¶æ€ç»“æ„è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **æ‰å¹³åŒ–ç»“æ„** | é¿å…æ·±åº¦åµŒå¥—ï¼Œä¾¿äºæ›´æ–°å’ŒæŸ¥è¯¢ | `{ byId: {}, allIds: [] }` |
| **çŠ¶æ€åˆ†ç¦»** | åŒºåˆ†UIçŠ¶æ€å’Œä¸šåŠ¡çŠ¶æ€ | `{ data: {}, ui: {} }` |
| **è§„èŒƒåŒ–æ•°æ®** | ä½¿ç”¨IDä½œä¸ºé”®å€¼ï¼Œé¿å…é‡å¤æ•°æ® | `users.byId['123']` |
| **å•ä¸€èŒè´£** | æ¯ä¸ªçŠ¶æ€ç‰‡æ®µåªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½åŸŸ | ç”¨æˆ·çŠ¶æ€ã€è®¤è¯çŠ¶æ€åˆ†ç¦» |

#### æ€§èƒ½ä¼˜åŒ–æŠ€å·§

```javascript
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨é€‰æ‹©å™¨
const selectActiveUsers = createSelector(
  [selectUsers, selectFilters],
  (users, filters) => users.filter(u => u.status === filters.status)
);

// âŒ é¿å…ï¼šåœ¨ç»„ä»¶ä¸­ç›´æ¥è®¡ç®—
function UserList() {
  const users = useSelector(state => state.users);
  const filters = useSelector(state => state.filters);

  // æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è®¡ç®—
  const activeUsers = users.filter(u => u.status === filters.status);
}
```

#### çŠ¶æ€æ›´æ–°æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|----------|------|
| **ä¸å¯å˜æ›´æ–°** | Redux, çº¯å‡½æ•°ç»„ä»¶ | `{ ...state, users: [...state.users, newUser] }` |
| **å¯å˜æ›´æ–°** | Immer, MobX | `state.users.push(newUser)` |
| **åŸå­æ›´æ–°** | Jotai, Recoil | `set(usersAtom, [...users, newUser])` |

## æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†

<Callout type="info">
æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†ä¸“æ³¨äºå¤„ç†å¼‚æ­¥æ•°æ®è·å–ã€ç¼“å­˜ã€åŒæ­¥ç­‰é—®é¢˜ï¼Œä¸å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†æœ‰ä¸åŒçš„å…³æ³¨ç‚¹ã€‚
</Callout>

### React Query / TanStack Query

#### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | ä¼˜åŠ¿ |
|------|------|------|
| **è‡ªåŠ¨ç¼“å­˜** | æ™ºèƒ½ç¼“å­˜ç®¡ç†ï¼Œå‡å°‘é‡å¤è¯·æ±‚ | æå‡æ€§èƒ½ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ |
| **åå°æ›´æ–°** | æ•°æ®è¿‡æœŸæ—¶è‡ªåŠ¨é‡æ–°è·å– | ä¿æŒæ•°æ®æ–°é²œåº¦ |
| **ä¹è§‚æ›´æ–°** | å…ˆæ›´æ–°UIï¼Œå†åŒæ­¥æœåŠ¡å™¨ | æå‡ç”¨æˆ·ä½“éªŒ |
| **é”™è¯¯é‡è¯•** | è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ | æé«˜å¯é æ€§ |

#### åŸºç¡€ç”¨æ³•

```javascript
// æ•°æ®æŸ¥è¯¢
import { useQuery } from '@tanstack/react-query';

function UserProfile({ userId }) {
  const { data: user, isLoading, error } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
    staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿç¼“å­˜
    retry: 3
  });

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  return <div>{user.name}</div>;
}

// æ•°æ®å˜æ›´
import { useMutation, useQueryClient } from '@tanstack/react-query';

function UpdateUserForm({ userId }) {
  const queryClient = useQueryClient();

  const updateUser = useMutation({
    mutationFn: (userData) => updateUserAPI(userData),
    onSuccess: (data) => {
      // æ›´æ–°ç¼“å­˜
      queryClient.setQueryData(['user', userId], data);
      // é‡æ–°è·å–ç›¸å…³æ•°æ®
      queryClient.invalidateQueries(['users']);
    }
  });

  return (
    <button
      onClick={() => updateUser.mutate({ name: 'New Name' })}
      disabled={updateUser.isLoading}
    >
      {updateUser.isLoading ? 'Updating...' : 'Update'}
    </button>
  );
}
```

#### é…ç½®é€‰é¡¹

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `staleTime` | 0 | æ•°æ®è¢«è®¤ä¸ºè¿‡æœŸçš„æ—¶é—´ |
| `cacheTime` | 5åˆ†é’Ÿ | ç¼“å­˜ä¿ç•™æ—¶é—´ |
| `retry` | 3 | å¤±è´¥é‡è¯•æ¬¡æ•° |
| `refetchOnWindowFocus` | true | çª—å£èšç„¦æ—¶é‡æ–°è·å– |

### SWR

#### SWRç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | SWR | React Query | è¯´æ˜ |
|------|-----|-------------|------|
| **åŒ…å¤§å°** | æ›´å° | è¾ƒå¤§ | SWRæ›´è½»é‡ |
| **APIè®¾è®¡** | ç®€æ´ | åŠŸèƒ½ä¸°å¯Œ | SWRæ›´æ˜“ä¸Šæ‰‹ |
| **ç¼“å­˜ç­–ç•¥** | åŸºç¡€ | é«˜çº§ | React Queryæ›´çµæ´» |
| **å¼€å‘å·¥å…·** | åŸºç¡€ | å®Œå–„ | React Queryå·¥å…·æ›´å¼º |

#### åŸºç¡€ç”¨æ³•

```javascript
import useSWR, { mutate } from 'swr';

const fetcher = (url) => fetch(url).then(res => res.json());

function UserList() {
  const { data: users, error, isLoading } = useSWR('/api/users', fetcher, {
    refreshInterval: 30000, // 30ç§’è‡ªåŠ¨åˆ·æ–°
    revalidateOnFocus: true, // çª—å£èšç„¦æ—¶é‡æ–°éªŒè¯
    dedupingInterval: 2000, // å»é‡é—´éš”
  });

  const deleteUser = async (userId) => {
    // ä¹è§‚æ›´æ–°
    const updatedUsers = users.filter(user => user.id !== userId);
    mutate('/api/users', updatedUsers, false);

    try {
      await fetch(`/api/users/${userId}`, { method: 'DELETE' });
      mutate('/api/users'); // é‡æ–°éªŒè¯
    } catch (error) {
      mutate('/api/users'); // å›æ»š
    }
  };

  if (error) return <div>Failed to load</div>;
  if (isLoading) return <div>Loading...</div>;

  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>
          {user.name}
          <button onClick={() => deleteUser(user.id)}>Delete</button>
        </li>
      ))}
    </ul>
  );
}
```

### Apollo Client (GraphQL)

#### Apollo Clientä¼˜åŠ¿

| ç‰¹æ€§ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **GraphQLåŸç”Ÿæ”¯æŒ** | å®Œæ•´çš„GraphQLå®¢æˆ·ç«¯è§£å†³æ–¹æ¡ˆ | GraphQL APIé¡¹ç›® |
| **æ™ºèƒ½ç¼“å­˜** | åŸºäºå­—æ®µçº§åˆ«çš„ç¼“å­˜ç³»ç»Ÿ | å¤æ‚æ•°æ®å…³ç³» |
| **å®æ—¶è®¢é˜…** | æ”¯æŒGraphQLè®¢é˜… | å®æ—¶æ•°æ®æ›´æ–° |
| **å¼€å‘å·¥å…·** | å¼ºå¤§çš„Apollo DevTools | è°ƒè¯•å’Œæ€§èƒ½åˆ†æ |

#### åŸºç¡€ç”¨æ³•

```javascript
import { useQuery, useMutation, gql } from '@apollo/client';

// å®šä¹‰æŸ¥è¯¢
const GET_USERS = gql`
  query GetUsers($filter: UserFilter) {
    users(filter: $filter) {
      id
      name
      email
      status
    }
  }
`;

// å®šä¹‰å˜æ›´
const UPDATE_USER = gql`
  mutation UpdateUser($id: ID!, $input: UserInput!) {
    updateUser(id: $id, input: $input) {
      id
      name
      email
      status
    }
  }
`;

function UserManagement() {
  // æŸ¥è¯¢æ•°æ®
  const { loading, error, data } = useQuery(GET_USERS, {
    variables: { filter: { status: 'ACTIVE' } },
    pollInterval: 30000, // è½®è¯¢
    fetchPolicy: 'cache-and-network'
  });

  // å˜æ›´æ•°æ®
  const [updateUser] = useMutation(UPDATE_USER, {
    update(cache, { data: { updateUser } }) {
      // æ›´æ–°ç¼“å­˜
      cache.modify({
        fields: {
          users(existingUsers = []) {
            return existingUsers.map(user =>
              user.__ref === cache.identify(updateUser) ? updateUser : user
            );
          }
        }
      });
    }
  });

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <div>
      {data.users.map(user => (
        <UserCard key={user.id} user={user} onUpdate={updateUser} />
      ))}
    </div>
  );
}
```

#### æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | å­¦ä¹ æˆæœ¬ | ç”Ÿæ€ç³»ç»Ÿ |
|------|----------|----------|----------|
| **React Query** | REST APIï¼Œå¤æ‚ç¼“å­˜éœ€æ±‚ | ä¸­ç­‰ | ä¸°å¯Œ |
| **SWR** | ç®€å•æ•°æ®è·å–ï¼Œè½»é‡çº§é¡¹ç›® | ä½ | ä¸­ç­‰ |
| **Apollo Client** | GraphQLé¡¹ç›® | é«˜ | å®Œå–„ |
| **Relay** | å¤§å‹GraphQLåº”ç”¨ | å¾ˆé«˜ | Facebookç”Ÿæ€ |

---

<Callout type="success">
é€‰æ‹©åˆé€‚çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆéœ€è¦ç»¼åˆè€ƒè™‘åº”ç”¨è§„æ¨¡ã€å›¢é˜Ÿç»éªŒã€æ€§èƒ½è¦æ±‚ç­‰å¤šä¸ªå› ç´ ã€‚æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆã€‚
</Callout>

---

## ğŸ“š å‚è€ƒå­¦ä¹ èµ„æ–™

### ğŸ“– å®˜æ–¹æ–‡æ¡£
- [Redux å®˜æ–¹æ–‡æ¡£](https://redux.js.org/) - ReduxçŠ¶æ€ç®¡ç†åº“
- [MobX å®˜æ–¹æ–‡æ¡£](https://mobx.js.org/) - MobXå“åº”å¼çŠ¶æ€ç®¡ç†
- [Zustand æ–‡æ¡£](https://github.com/pmndrs/zustand) - è½»é‡çº§çŠ¶æ€ç®¡ç†
- [Recoil å®˜æ–¹æ–‡æ¡£](https://recoiljs.org/) - Facebookå®éªŒæ€§çŠ¶æ€ç®¡ç†

### ğŸ“ ä¼˜è´¨æ•™ç¨‹
- [Redux å®˜æ–¹æ•™ç¨‹](https://redux.js.org/tutorials/essentials/part-1-overview-concepts) - ReduxåŸºç¡€æ•™ç¨‹
- [MobX å…¥é—¨æŒ‡å—](https://mobx.js.org/getting-started) - MobXå¿«é€Ÿå…¥é—¨
- [çŠ¶æ€ç®¡ç†æ¨¡å¼](https://vuex.vuejs.org/zh/guide/) - VuexçŠ¶æ€ç®¡ç†æ¨¡å¼

### ğŸ› ï¸ å®è·µé¡¹ç›®
- [Redux Examples](https://github.com/reduxjs/redux/tree/master/examples) - Reduxå®˜æ–¹ç¤ºä¾‹
- [MobX Examples](https://github.com/mobxjs/mobx/tree/main/packages/mobx-react-lite/examples) - MobXç¤ºä¾‹é¡¹ç›®
- [State Management Patterns](https://github.com/topics/state-management) - çŠ¶æ€ç®¡ç†æ¨¡å¼é›†åˆ

### ğŸ”§ å¼€å‘å·¥å…·
- [Redux DevTools](https://github.com/reduxjs/redux-devtools) - Reduxè°ƒè¯•å·¥å…·
- [MobX DevTools](https://github.com/mobxjs/mobx-devtools) - MobXå¼€å‘å·¥å…·
- [React Developer Tools](https://react.dev/learn/react-developer-tools) - ReactçŠ¶æ€è°ƒè¯•
- [Vue DevTools](https://devtools.vuejs.org/) - VueçŠ¶æ€è°ƒè¯•å·¥å…·

### ğŸ“ æ·±å…¥é˜…è¯»
- [You Might Not Need Redux](https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367) - Reduxä½¿ç”¨åœºæ™¯æ€è€ƒ
- [State Management Patterns](https://blog.logrocket.com/state-management-patterns-in-react-ecosystem/) - ReactçŠ¶æ€ç®¡ç†æ¨¡å¼
- [Modern State Management](https://kentcdodds.com/blog/application-state-management-with-react) - ç°ä»£çŠ¶æ€ç®¡ç†æ€è€ƒ

<Callout type="tip">
ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå»ºè®®ä»Reactå†…ç½®çŠ¶æ€ç®¡ç†å¼€å§‹ï¼Œç„¶åå­¦ä¹ Reduxç†è§£çŠ¶æ€ç®¡ç†åŸç†ï¼Œæ¥ç€æ¢ç´¢MobXç­‰å…¶ä»–æ–¹æ¡ˆï¼Œæœ€åæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚
</Callout>
