import { Callout } from 'nextra/components'

# 14. 移动端开发

## 📋 目录

- [移动端开发技术栈](#移动端开发技术栈)
- [React Native深入开发](#react-native深入开发)
- [Flutter跨平台开发](#flutter跨平台开发)
- [原生模块和桥接](#原生模块和桥接)
- [性能优化策略](#性能优化策略)
- [发布和分发](#发布和分发)

## 移动端开发技术栈

<Callout type="info">
移动端开发技术日新月异，选择合适的技术栈能够大大提升开发效率和应用性能。
</Callout>

### 移动端技术方案对比

#### 主流移动端开发技术对比

| 技术方案 | 语言/技术栈 | 渲染方式 | 性能 | 开发效率 | 学习成本 | 适用场景 |
|----------|-------------|----------|------|----------|----------|----------|
| **iOS原生** | Swift/Objective-C | 原生 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ | 高性能iOS应用 |
| **Android原生** | Kotlin/Java | 原生 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ | 高性能Android应用 |
| **React Native** | React + JS/TS | 原生组件 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | 快速跨平台开发 |
| **Flutter** | Dart | 自绘引擎 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 复杂UI、高性能 |
| **Ionic** | Web技术 | WebView | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | 简单应用、快速原型 |

#### 技术选择指南

| 项目特征 | 推荐技术 | 理由 |
|----------|----------|------|
| **高性能要求** | 原生开发 | 最佳性能和平台集成 |
| **React团队** | React Native | 技能复用，快速开发 |
| **复杂UI** | Flutter | 优秀的UI性能和一致性 |
| **预算有限** | Ionic | 低成本，快速上线 |
| **快速原型** | React Native/Ionic | 开发效率高 |

#### 知名应用案例

| 技术 | 知名应用 | 特点 |
|------|----------|------|
| **React Native** | Facebook, Instagram, Uber Eats | 内容展示、社交应用 |
| **Flutter** | Google Pay, Alibaba, BMW | 复杂交互、金融应用 |
| **原生** | 微信, 支付宝, 王者荣耀 | 高性能、平台特定功能 |

#### 技术选择决策流程

```javascript
// 简化的技术选择逻辑
function chooseMobileTechnology(requirements) {
  const { teamSkills, performance, timeline, budget } = requirements;

  // 高性能要求
  if (performance === 'critical') {
    return 'Native Development';
  }

  // React技术栈
  if (teamSkills.includes('react') && timeline === 'short') {
    return 'React Native';
  }

  // 复杂UI需求
  if (requirements.uiComplexity === 'high') {
    return 'Flutter';
  }

  // 预算有限
  if (budget === 'limited') {
    return 'Ionic';
  }

  return 'React Native'; // 默认推荐
}
```

## React Native深入开发

### React Native架构和组件

```typescript
// 1. 核心组件和API使用
import React, { useState, useEffect, useCallback } from 'react';
import {
  View,
  Text,
  ScrollView,
  FlatList,
  Image,
  TouchableOpacity,
  StyleSheet,
  Dimensions,
  Platform,
  Alert,
  Linking,
  Share
} from 'react-native';
import { SafeAreaProvider, SafeAreaView } from 'react-native-safe-area-context';
import AsyncStorage from '@react-native-async-storage/async-storage';

// 获取设备信息
const { width: screenWidth, height: screenHeight } = Dimensions.get('window');
const isIOS = Platform.OS === 'ios';
const isAndroid = Platform.OS === 'android';

// 用户列表组件
interface User {
  id: string;
  name: string;
  email: string;
  avatar: string;
  isOnline: boolean;
}

interface UserListProps {
  users: User[];
  onUserPress: (user: User) => void;
  onRefresh: () => Promise<void>;
}

const UserList: React.FC<UserListProps> = ({ users, onUserPress, onRefresh }) => {
  const [refreshing, setRefreshing] = useState(false);
  
  const handleRefresh = useCallback(async () => {
    setRefreshing(true);
    try {
      await onRefresh();
    } finally {
      setRefreshing(false);
    }
  }, [onRefresh]);
  
  const renderUser = useCallback(({ item }: { item: User }) => (
    <TouchableOpacity
      style={styles.userItem}
      onPress={() => onUserPress(item)}
      activeOpacity={0.7}
    >
      <Image source={{ uri: item.avatar }} style={styles.avatar} />
      <View style={styles.userInfo}>
        <Text style={styles.userName}>{item.name}</Text>
        <Text style={styles.userEmail}>{item.email}</Text>
      </View>
      <View style={[
        styles.onlineIndicator,
        { backgroundColor: item.isOnline ? '#4CAF50' : '#9E9E9E' }
      ]} />
    </TouchableOpacity>
  ), [onUserPress]);
  
  const keyExtractor = useCallback((item: User) => item.id, []);
  
  return (
    <FlatList
      data={users}
      renderItem={renderUser}
      keyExtractor={keyExtractor}
      refreshing={refreshing}
      onRefresh={handleRefresh}
      showsVerticalScrollIndicator={false}
      contentContainerStyle={styles.listContainer}
      ItemSeparatorComponent={() => <View style={styles.separator} />}
      ListEmptyComponent={() => (
        <View style={styles.emptyContainer}>
          <Text style={styles.emptyText}>暂无用户数据</Text>
        </View>
      )}
    />
  );
};

// 主应用组件
const App: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    loadUsers();
  }, []);
  
  const loadUsers = async () => {
    try {
      setLoading(true);
      
      // 从本地存储加载缓存数据
      const cachedUsers = await AsyncStorage.getItem('users');
      if (cachedUsers) {
        setUsers(JSON.parse(cachedUsers));
      }
      
      // 从API获取最新数据
      const response = await fetch('https://api.example.com/users');
      const freshUsers = await response.json();
      
      setUsers(freshUsers);
      
      // 缓存到本地存储
      await AsyncStorage.setItem('users', JSON.stringify(freshUsers));
    } catch (error) {
      console.error('加载用户失败:', error);
      Alert.alert('错误', '加载用户数据失败');
    } finally {
      setLoading(false);
    }
  };
  
  const handleUserPress = useCallback((user: User) => {
    Alert.alert(
      user.name,
      `邮箱: ${user.email}`,
      [
        { text: '取消', style: 'cancel' },
        {
          text: '发送邮件',
          onPress: () => {
            Linking.openURL(`mailto:${user.email}`);
          }
        },
        {
          text: '分享',
          onPress: () => {
            Share.share({
              message: `推荐用户: ${user.name} (${user.email})`,
              title: '用户分享'
            });
          }
        }
      ]
    );
  }, []);
  
  const handleRefresh = useCallback(async () => {
    await loadUsers();
  }, []);
  
  if (loading) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.loadingContainer}>
          <Text>加载中...</Text>
        </View>
      </SafeAreaView>
    );
  }
  
  return (
    <SafeAreaProvider>
      <SafeAreaView style={styles.container}>
        <View style={styles.header}>
          <Text style={styles.headerTitle}>用户列表</Text>
        </View>
        
        <UserList
          users={users}
          onUserPress={handleUserPress}
          onRefresh={handleRefresh}
        />
      </SafeAreaView>
    </SafeAreaProvider>
  );
};

// 样式定义
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5'
  },
  header: {
    backgroundColor: '#2196F3',
    paddingVertical: 16,
    paddingHorizontal: 20,
    ...Platform.select({
      ios: {
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4
      },
      android: {
        elevation: 4
      }
    })
  },
  headerTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#fff',
    textAlign: 'center'
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center'
  },
  listContainer: {
    padding: 16
  },
  userItem: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#fff',
    padding: 16,
    borderRadius: 8,
    ...Platform.select({
      ios: {
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 1 },
        shadowOpacity: 0.1,
        shadowRadius: 2
      },
      android: {
        elevation: 2
      }
    })
  },
  avatar: {
    width: 50,
    height: 50,
    borderRadius: 25,
    marginRight: 12
  },
  userInfo: {
    flex: 1
  },
  userName: {
    fontSize: 16,
    fontWeight: '600',
    color: '#333',
    marginBottom: 4
  },
  userEmail: {
    fontSize: 14,
    color: '#666'
  },
  onlineIndicator: {
    width: 12,
    height: 12,
    borderRadius: 6
  },
  separator: {
    height: 12
  },
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingVertical: 50
  },
  emptyText: {
    fontSize: 16,
    color: '#999'
  }
});

export default App;
```

### 导航和状态管理

```typescript
// 1. React Navigation设置
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { createDrawerNavigator } from '@react-navigation/drawer';
import Icon from 'react-native-vector-icons/MaterialIcons';

// 类型定义
export type RootStackParamList = {
  Main: undefined;
  UserDetail: { userId: string };
  Settings: undefined;
};

export type TabParamList = {
  Home: undefined;
  Users: undefined;
  Profile: undefined;
};

const Stack = createNativeStackNavigator<RootStackParamList>();
const Tab = createBottomTabNavigator<TabParamList>();
const Drawer = createDrawerNavigator();

// 标签页导航
function TabNavigator() {
  return (
    <Tab.Navigator
      screenOptions={({ route }) => ({
        tabBarIcon: ({ focused, color, size }) => {
          let iconName: string;
          
          switch (route.name) {
            case 'Home':
              iconName = 'home';
              break;
            case 'Users':
              iconName = 'people';
              break;
            case 'Profile':
              iconName = 'person';
              break;
            default:
              iconName = 'help';
          }
          
          return <Icon name={iconName} size={size} color={color} />;
        },
        tabBarActiveTintColor: '#2196F3',
        tabBarInactiveTintColor: '#999',
        headerShown: false
      })}
    >
      <Tab.Screen name="Home" component={HomeScreen} />
      <Tab.Screen name="Users" component={UsersScreen} />
      <Tab.Screen name="Profile" component={ProfileScreen} />
    </Tab.Navigator>
  );
}

// 主导航
function AppNavigator() {
  return (
    <NavigationContainer>
      <Stack.Navigator
        initialRouteName="Main"
        screenOptions={{
          headerStyle: {
            backgroundColor: '#2196F3'
          },
          headerTintColor: '#fff',
          headerTitleStyle: {
            fontWeight: 'bold'
          }
        }}
      >
        <Stack.Screen 
          name="Main" 
          component={TabNavigator}
          options={{ headerShown: false }}
        />
        <Stack.Screen 
          name="UserDetail" 
          component={UserDetailScreen}
          options={({ route }) => ({
            title: '用户详情',
            headerBackTitle: '返回'
          })}
        />
        <Stack.Screen 
          name="Settings" 
          component={SettingsScreen}
          options={{
            title: '设置',
            presentation: 'modal'
          }}
        />
      </Stack.Navigator>
    </NavigationContainer>
  );
}

// 2. Redux Toolkit状态管理
import { configureStore, createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { Provider, useSelector, useDispatch } from 'react-redux';

// 异步操作
export const fetchUsers = createAsyncThunk(
  'users/fetchUsers',
  async (_, { rejectWithValue }) => {
    try {
      const response = await fetch('https://api.example.com/users');
      if (!response.ok) {
        throw new Error('网络请求失败');
      }
      return await response.json();
    } catch (error) {
      return rejectWithValue(error.message);
    }
  }
);

// 用户状态切片
const usersSlice = createSlice({
  name: 'users',
  initialState: {
    items: [] as User[],
    loading: false,
    error: null as string | null
  },
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    updateUser: (state, action) => {
      const { id, updates } = action.payload;
      const userIndex = state.items.findIndex(user => user.id === id);
      if (userIndex !== -1) {
        state.items[userIndex] = { ...state.items[userIndex], ...updates };
      }
    }
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchUsers.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchUsers.fulfilled, (state, action) => {
        state.loading = false;
        state.items = action.payload;
      })
      .addCase(fetchUsers.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      });
  }
});

export const { clearError, updateUser } = usersSlice.actions;

// Store配置
const store = configureStore({
  reducer: {
    users: usersSlice.reducer
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: ['persist/PERSIST']
      }
    })
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;

// 3. 自定义Hooks
import { useSelector, useDispatch } from 'react-redux';
import { useFocusEffect } from '@react-navigation/native';

export const useAppSelector = useSelector.withTypes<RootState>();
export const useAppDispatch = useDispatch.withTypes<AppDispatch>();

// 用户数据Hook
export function useUsers() {
  const dispatch = useAppDispatch();
  const { items: users, loading, error } = useAppSelector(state => state.users);
  
  const loadUsers = useCallback(() => {
    dispatch(fetchUsers());
  }, [dispatch]);
  
  const updateUserData = useCallback((id: string, updates: Partial<User>) => {
    dispatch(updateUser({ id, updates }));
  }, [dispatch]);
  
  const clearErrorMessage = useCallback(() => {
    dispatch(clearError());
  }, [dispatch]);
  
  // 页面聚焦时刷新数据
  useFocusEffect(
    useCallback(() => {
      loadUsers();
    }, [loadUsers])
  );
  
  return {
    users,
    loading,
    error,
    loadUsers,
    updateUserData,
    clearErrorMessage
  };
}

// 设备信息Hook
export function useDeviceInfo() {
  const [deviceInfo, setDeviceInfo] = useState({
    width: screenWidth,
    height: screenHeight,
    isLandscape: false
  });
  
  useEffect(() => {
    const subscription = Dimensions.addEventListener('change', ({ window }) => {
      setDeviceInfo({
        width: window.width,
        height: window.height,
        isLandscape: window.width > window.height
      });
    });
    
    return () => subscription?.remove();
  }, []);
  
  return deviceInfo;
}

// 4. 应用入口
function App() {
  return (
    <Provider store={store}>
      <AppNavigator />
    </Provider>
  );
}

export default App;
```

### 原生模块集成

```typescript
// 1. 原生模块桥接 (iOS)
// ios/MyApp/NativeModule.h
#import <React/RCTBridgeModule.h>
#import <React/RCTEventEmitter.h>

@interface NativeModule : RCTEventEmitter <RCTBridgeModule>
@end

// ios/MyApp/NativeModule.m
#import "NativeModule.h"
#import <React/RCTLog.h>

@implementation NativeModule

RCT_EXPORT_MODULE();

// 支持事件发送
- (NSArray<NSString *> *)supportedEvents {
  return @[@"onLocationUpdate", @"onBatteryChange"];
}

// 获取设备信息
RCT_EXPORT_METHOD(getDeviceInfo:(RCTPromiseResolveBlock)resolve
                  rejecter:(RCTPromiseRejectBlock)reject) {
  @try {
    UIDevice *device = [UIDevice currentDevice];
    NSDictionary *deviceInfo = @{
      @"name": device.name,
      @"model": device.model,
      @"systemName": device.systemName,
      @"systemVersion": device.systemVersion,
      @"batteryLevel": @(device.batteryLevel)
    };
    resolve(deviceInfo);
  } @catch (NSException *exception) {
    reject(@"device_info_error", @"Failed to get device info", nil);
  }
}

// 显示原生弹窗
RCT_EXPORT_METHOD(showNativeAlert:(NSString *)title
                  message:(NSString *)message
                  resolver:(RCTPromiseResolveBlock)resolve
                  rejecter:(RCTPromiseRejectBlock)reject) {
  dispatch_async(dispatch_get_main_queue(), ^{
    UIAlertController *alert = [UIAlertController 
      alertControllerWithTitle:title 
      message:message 
      preferredStyle:UIAlertControllerStyleAlert];
    
    UIAlertAction *okAction = [UIAlertAction 
      actionWithTitle:@"确定" 
      style:UIAlertActionStyleDefault 
      handler:^(UIAlertAction * action) {
        resolve(@"ok");
      }];
    
    [alert addAction:okAction];
    
    UIViewController *rootViewController = [UIApplication sharedApplication].delegate.window.rootViewController;
    [rootViewController presentViewController:alert animated:YES completion:nil];
  });
}

@end

// 2. 原生模块桥接 (Android)
// android/app/src/main/java/com/myapp/NativeModule.java
package com.myapp;

import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;
import com.facebook.react.bridge.ReactMethod;
import com.facebook.react.bridge.Promise;
import com.facebook.react.bridge.WritableMap;
import com.facebook.react.bridge.Arguments;
import com.facebook.react.modules.core.DeviceEventManagerModule;

import android.os.Build;
import android.content.Context;
import android.app.AlertDialog;

public class NativeModule extends ReactContextBaseJavaModule {
    private ReactApplicationContext reactContext;
    
    public NativeModule(ReactApplicationContext reactContext) {
        super(reactContext);
        this.reactContext = reactContext;
    }
    
    @Override
    public String getName() {
        return "NativeModule";
    }
    
    @ReactMethod
    public void getDeviceInfo(Promise promise) {
        try {
            WritableMap deviceInfo = Arguments.createMap();
            deviceInfo.putString("manufacturer", Build.MANUFACTURER);
            deviceInfo.putString("model", Build.MODEL);
            deviceInfo.putString("version", Build.VERSION.RELEASE);
            deviceInfo.putInt("sdkVersion", Build.VERSION.SDK_INT);
            
            promise.resolve(deviceInfo);
        } catch (Exception e) {
            promise.reject("device_info_error", "Failed to get device info", e);
        }
    }
    
    @ReactMethod
    public void showNativeAlert(String title, String message, Promise promise) {
        getCurrentActivity().runOnUiThread(new Runnable() {
            @Override
            public void run() {
                AlertDialog.Builder builder = new AlertDialog.Builder(getCurrentActivity());
                builder.setTitle(title)
                       .setMessage(message)
                       .setPositiveButton("确定", (dialog, which) -> {
                           promise.resolve("ok");
                       })
                       .show();
            }
        });
    }
    
    // 发送事件到JavaScript
    private void sendEvent(String eventName, WritableMap params) {
        reactContext
            .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)
            .emit(eventName, params);
    }
}

// 3. JavaScript端使用
import { NativeModules, NativeEventEmitter } from 'react-native';

const { NativeModule } = NativeModules;
const nativeEventEmitter = new NativeEventEmitter(NativeModule);

// 原生模块Hook
export function useNativeModule() {
  const [deviceInfo, setDeviceInfo] = useState(null);
  
  useEffect(() => {
    // 获取设备信息
    NativeModule.getDeviceInfo()
      .then(setDeviceInfo)
      .catch(console.error);
    
    // 监听原生事件
    const locationSubscription = nativeEventEmitter.addListener(
      'onLocationUpdate',
      (location) => {
        console.log('位置更新:', location);
      }
    );
    
    const batterySubscription = nativeEventEmitter.addListener(
      'onBatteryChange',
      (battery) => {
        console.log('电池状态:', battery);
      }
    );
    
    return () => {
      locationSubscription.remove();
      batterySubscription.remove();
    };
  }, []);
  
  const showNativeAlert = useCallback(async (title: string, message: string) => {
    try {
      const result = await NativeModule.showNativeAlert(title, message);
      console.log('弹窗结果:', result);
    } catch (error) {
      console.error('显示弹窗失败:', error);
    }
  }, []);
  
  return {
    deviceInfo,
    showNativeAlert
  };
}

// 使用示例
function DeviceInfoScreen() {
  const { deviceInfo, showNativeAlert } = useNativeModule();
  
  const handleShowAlert = () => {
    showNativeAlert('原生弹窗', '这是来自原生模块的弹窗');
  };
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>设备信息</Text>
      
      {deviceInfo && (
        <View style={styles.infoContainer}>
          <Text>设备型号: {deviceInfo.model}</Text>
          <Text>系统版本: {deviceInfo.systemVersion || deviceInfo.version}</Text>
          <Text>制造商: {deviceInfo.manufacturer}</Text>
        </View>
      )}
      
      <TouchableOpacity style={styles.button} onPress={handleShowAlert}>
        <Text style={styles.buttonText}>显示原生弹窗</Text>
      </TouchableOpacity>
    </View>
  );
}
```

## Flutter跨平台开发

<Callout type="info">
[Flutter](https://flutter.dev/)是Google开发的跨平台UI框架，使用Dart语言，能够创建高性能的原生应用。
</Callout>

### Flutter基础开发

```dart
// 1. Flutter应用结构
import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        visualDensity: VisualDensity.adaptivePlatformDensity,
      ),
      home: HomeScreen(),
    );
  }
}

// 2. 状态管理 - Provider模式
class UserModel extends ChangeNotifier {
  User? _user;
  bool _isLoading = false;
  String? _error;

  User? get user => _user;
  bool get isLoading => _isLoading;
  String? get error => _error;

  Future<void> fetchUser(String userId) async {
    _isLoading = true;
    _error = null;
    notifyListeners();

    try {
      _user = await UserService.getUser(userId);
    } catch (e) {
      _error = e.toString();
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }

  void updateUser(User user) {
    _user = user;
    notifyListeners();
  }
}

// 3. 响应式UI组件
class UserProfileScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('用户资料'),
        actions: [
          IconButton(
            icon: Icon(Icons.edit),
            onPressed: () => _editProfile(context),
          ),
        ],
      ),
      body: Consumer<UserModel>(
        builder: (context, userModel, child) {
          if (userModel.isLoading) {
            return Center(child: CircularProgressIndicator());
          }

          if (userModel.error != null) {
            return Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(Icons.error, size: 64, color: Colors.red),
                  SizedBox(height: 16),
                  Text(userModel.error!),
                  ElevatedButton(
                    onPressed: () => userModel.fetchUser('current'),
                    child: Text('重试'),
                  ),
                ],
              ),
            );
          }

          final user = userModel.user;
          if (user == null) {
            return Center(child: Text('用户信息不存在'));
          }

          return SingleChildScrollView(
            padding: EdgeInsets.all(16),
            child: Column(
              children: [
                CircleAvatar(
                  radius: 50,
                  backgroundImage: NetworkImage(user.avatar),
                ),
                SizedBox(height: 16),
                Text(
                  user.name,
                  style: Theme.of(context).textTheme.headline5,
                ),
                SizedBox(height: 8),
                Text(
                  user.email,
                  style: Theme.of(context).textTheme.subtitle1,
                ),
                SizedBox(height: 24),
                _buildInfoCard(context, user),
              ],
            ),
          );
        },
      ),
    );
  }

  Widget _buildInfoCard(BuildContext context, User user) {
    return Card(
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              '个人信息',
              style: Theme.of(context).textTheme.headline6,
            ),
            SizedBox(height: 16),
            _buildInfoRow('手机号', user.phone),
            _buildInfoRow('生日', user.birthday),
            _buildInfoRow('地址', user.address),
          ],
        ),
      ),
    );
  }

  Widget _buildInfoRow(String label, String value) {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 8),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          SizedBox(
            width: 80,
            child: Text(
              label,
              style: TextStyle(fontWeight: FontWeight.bold),
            ),
          ),
          Expanded(child: Text(value)),
        ],
      ),
    );
  }

  void _editProfile(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => EditProfileScreen()),
    );
  }
}

// 4. 自定义Widget
class AnimatedCounter extends StatefulWidget {
  final int value;
  final Duration duration;

  const AnimatedCounter({
    Key? key,
    required this.value,
    this.duration = const Duration(milliseconds: 500),
  }) : super(key: key);

  @override
  _AnimatedCounterState createState() => _AnimatedCounterState();
}

class _AnimatedCounterState extends State<AnimatedCounter>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<double> _animation;
  int _previousValue = 0;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: widget.duration,
      vsync: this,
    );
    _animation = Tween<double>(
      begin: 0,
      end: widget.value.toDouble(),
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeInOut,
    ));
    _controller.forward();
  }

  @override
  void didUpdateWidget(AnimatedCounter oldWidget) {
    super.didUpdateWidget(oldWidget);
    if (oldWidget.value != widget.value) {
      _previousValue = oldWidget.value;
      _animation = Tween<double>(
        begin: _previousValue.toDouble(),
        end: widget.value.toDouble(),
      ).animate(CurvedAnimation(
        parent: _controller,
        curve: Curves.easeInOut,
      ));
      _controller.reset();
      _controller.forward();
    }
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return AnimatedBuilder(
      animation: _animation,
      builder: (context, child) {
        return Text(
          _animation.value.round().toString(),
          style: Theme.of(context).textTheme.headline4,
        );
      },
    );
  }
}
```

## 性能优化策略

<Callout type="warning">
移动端应用的性能优化需要考虑设备性能限制、网络环境、电池消耗等多个因素。
</Callout>

### React Native性能优化

```javascript
// 1. 列表性能优化
import React, { memo, useCallback, useMemo } from 'react';
import { FlatList, VirtualizedList } from 'react-native';

// 使用memo优化列表项
const ListItem = memo(({ item, onPress }) => {
  const handlePress = useCallback(() => {
    onPress(item.id);
  }, [item.id, onPress]);

  return (
    <TouchableOpacity onPress={handlePress} style={styles.listItem}>
      <Image source={{ uri: item.avatar }} style={styles.avatar} />
      <View style={styles.content}>
        <Text style={styles.name}>{item.name}</Text>
        <Text style={styles.email}>{item.email}</Text>
      </View>
    </TouchableOpacity>
  );
});

// 优化的列表组件
function OptimizedUserList({ users, onUserPress }) {
  const keyExtractor = useCallback((item) => item.id, []);

  const renderItem = useCallback(({ item }) => (
    <ListItem item={item} onPress={onUserPress} />
  ), [onUserPress]);

  const getItemLayout = useCallback((data, index) => ({
    length: 80, // 固定高度
    offset: 80 * index,
    index,
  }), []);

  return (
    <FlatList
      data={users}
      renderItem={renderItem}
      keyExtractor={keyExtractor}
      getItemLayout={getItemLayout}
      removeClippedSubviews={true}
      maxToRenderPerBatch={10}
      windowSize={10}
      initialNumToRender={10}
      updateCellsBatchingPeriod={50}
    />
  );
}

// 2. 图片优化
import FastImage from 'react-native-fast-image';

function OptimizedImage({ uri, style, placeholder }) {
  return (
    <FastImage
      style={style}
      source={{
        uri,
        priority: FastImage.priority.normal,
        cache: FastImage.cacheControl.immutable,
      }}
      defaultSource={placeholder}
      resizeMode={FastImage.resizeMode.cover}
    />
  );
}

// 3. 动画性能优化
import Animated, {
  useSharedValue,
  useAnimatedStyle,
  withSpring,
  runOnJS,
} from 'react-native-reanimated';

function AnimatedButton({ onPress, children }) {
  const scale = useSharedValue(1);
  const opacity = useSharedValue(1);

  const animatedStyle = useAnimatedStyle(() => ({
    transform: [{ scale: scale.value }],
    opacity: opacity.value,
  }));

  const handlePressIn = () => {
    scale.value = withSpring(0.95);
    opacity.value = withSpring(0.8);
  };

  const handlePressOut = () => {
    scale.value = withSpring(1);
    opacity.value = withSpring(1);
  };

  const handlePress = () => {
    runOnJS(onPress)();
  };

  return (
    <Animated.View style={animatedStyle}>
      <TouchableWithoutFeedback
        onPressIn={handlePressIn}
        onPressOut={handlePressOut}
        onPress={handlePress}
      >
        <View style={styles.button}>
          {children}
        </View>
      </TouchableWithoutFeedback>
    </Animated.View>
  );
}

// 4. 内存管理
class MemoryOptimizedComponent extends Component {
  constructor(props) {
    super(props);
    this.subscriptions = [];
  }

  componentDidMount() {
    // 订阅管理
    const subscription = EventEmitter.addListener('dataUpdate', this.handleDataUpdate);
    this.subscriptions.push(subscription);
  }

  componentWillUnmount() {
    // 清理订阅
    this.subscriptions.forEach(subscription => {
      subscription.remove();
    });
    this.subscriptions = [];
  }

  handleDataUpdate = (data) => {
    // 处理数据更新
  };

  render() {
    return (
      <View>
        {/* 组件内容 */}
      </View>
    );
  }
}
```

### Flutter性能优化

```dart
// 1. Widget优化
class OptimizedListView extends StatelessWidget {
  final List<Item> items;
  final Function(Item) onItemTap;

  const OptimizedListView({
    Key? key,
    required this.items,
    required this.onItemTap,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: items.length,
      itemBuilder: (context, index) {
        final item = items[index];
        return ListItemWidget(
          key: ValueKey(item.id), // 使用稳定的key
          item: item,
          onTap: () => onItemTap(item),
        );
      },
      // 性能优化配置
      cacheExtent: 200.0,
      addAutomaticKeepAlives: false,
      addRepaintBoundaries: false,
    );
  }
}

// 2. 状态管理优化
class OptimizedCounter extends StatefulWidget {
  @override
  _OptimizedCounterState createState() => _OptimizedCounterState();
}

class _OptimizedCounterState extends State<OptimizedCounter> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Column(
        children: [
          // 使用const构造函数避免重建
          const Text('计数器应用'),

          // 将变化的部分分离
          CounterDisplay(counter: _counter),

          // 静态部分使用const
          const SizedBox(height: 20),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        child: const Icon(Icons.add),
      ),
    );
  }
}

class CounterDisplay extends StatelessWidget {
  final int counter;

  const CounterDisplay({Key? key, required this.counter}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Text(
      '$counter',
      style: Theme.of(context).textTheme.headline4,
    );
  }
}

// 3. 图片缓存优化
class CachedNetworkImageWidget extends StatelessWidget {
  final String imageUrl;
  final double? width;
  final double? height;

  const CachedNetworkImageWidget({
    Key? key,
    required this.imageUrl,
    this.width,
    this.height,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return CachedNetworkImage(
      imageUrl: imageUrl,
      width: width,
      height: height,
      placeholder: (context, url) => Container(
        width: width,
        height: height,
        color: Colors.grey[300],
        child: const Center(
          child: CircularProgressIndicator(),
        ),
      ),
      errorWidget: (context, url, error) => Container(
        width: width,
        height: height,
        color: Colors.grey[300],
        child: const Icon(Icons.error),
      ),
      memCacheWidth: width?.toInt(),
      memCacheHeight: height?.toInt(),
    );
  }
}

// 4. 异步操作优化
class DataService {
  static final Map<String, dynamic> _cache = {};
  static final Map<String, Future<dynamic>> _pendingRequests = {};

  static Future<T> fetchData<T>(
    String key,
    Future<T> Function() fetcher, {
    Duration? cacheDuration,
  }) async {
    // 检查缓存
    if (_cache.containsKey(key)) {
      final cachedData = _cache[key];
      if (cachedData['expiry'] == null ||
          DateTime.now().isBefore(cachedData['expiry'])) {
        return cachedData['data'] as T;
      }
    }

    // 检查是否有正在进行的请求
    if (_pendingRequests.containsKey(key)) {
      return await _pendingRequests[key] as T;
    }

    // 创建新请求
    final future = fetcher();
    _pendingRequests[key] = future;

    try {
      final data = await future;

      // 缓存结果
      _cache[key] = {
        'data': data,
        'expiry': cacheDuration != null
          ? DateTime.now().add(cacheDuration)
          : null,
      };

      return data;
    } finally {
      _pendingRequests.remove(key);
    }
  }

  static void clearCache() {
    _cache.clear();
  }
}
```

## 发布和分发

<Callout type="info">
移动应用的发布和分发涉及应用商店审核、版本管理、持续集成等多个环节。
</Callout>

### React Native应用发布

```bash
# 1. Android发布流程
# 生成签名密钥
keytool -genkeypair -v -storetype PKCS12 -keystore my-upload-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000

# 配置gradle.properties
MYAPP_UPLOAD_STORE_FILE=my-upload-key.keystore
MYAPP_UPLOAD_KEY_ALIAS=my-key-alias
MYAPP_UPLOAD_STORE_PASSWORD=*****
MYAPP_UPLOAD_KEY_PASSWORD=*****

# 构建发布版本
cd android
./gradlew bundleRelease

# 2. iOS发布流程
# 配置Xcode项目
# 1. 设置Bundle Identifier
# 2. 配置Signing & Capabilities
# 3. 设置版本号和构建号

# 构建Archive
xcodebuild -workspace ios/MyApp.xcworkspace -scheme MyApp -configuration Release archive -archivePath ios/build/MyApp.xcarchive

# 导出IPA
xcodebuild -exportArchive -archivePath ios/build/MyApp.xcarchive -exportPath ios/build -exportOptionsPlist ios/ExportOptions.plist
```

```javascript
// 3. 自动化发布脚本
// scripts/release.js
const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

class ReleaseManager {
  constructor(platform, buildType = 'release') {
    this.platform = platform;
    this.buildType = buildType;
    this.packageJson = require('../package.json');
  }

  async release() {
    console.log(`开始发布 ${this.platform} 应用...`);

    try {
      // 1. 检查环境
      await this.checkEnvironment();

      // 2. 更新版本号
      await this.updateVersion();

      // 3. 构建应用
      await this.buildApp();

      // 4. 运行测试
      await this.runTests();

      // 5. 上传到应用商店
      await this.uploadToStore();

      console.log('发布成功！');
    } catch (error) {
      console.error('发布失败:', error);
      process.exit(1);
    }
  }

  async checkEnvironment() {
    console.log('检查发布环境...');

    if (this.platform === 'android') {
      // 检查Android环境
      execSync('which keytool', { stdio: 'ignore' });
      execSync('which zipalign', { stdio: 'ignore' });
    } else if (this.platform === 'ios') {
      // 检查iOS环境
      execSync('which xcodebuild', { stdio: 'ignore' });
      execSync('which xcrun', { stdio: 'ignore' });
    }
  }

  async updateVersion() {
    console.log('更新版本号...');

    const currentVersion = this.packageJson.version;
    const versionParts = currentVersion.split('.');
    versionParts[2] = (parseInt(versionParts[2]) + 1).toString();
    const newVersion = versionParts.join('.');

    // 更新package.json
    this.packageJson.version = newVersion;
    fs.writeFileSync(
      path.join(__dirname, '../package.json'),
      JSON.stringify(this.packageJson, null, 2)
    );

    // 更新原生项目版本
    if (this.platform === 'android') {
      this.updateAndroidVersion(newVersion);
    } else if (this.platform === 'ios') {
      this.updateiOSVersion(newVersion);
    }
  }

  updateAndroidVersion(version) {
    const buildGradlePath = path.join(__dirname, '../android/app/build.gradle');
    let buildGradle = fs.readFileSync(buildGradlePath, 'utf8');

    // 更新versionName
    buildGradle = buildGradle.replace(
      /versionName\s+"[^"]*"/,
      `versionName "${version}"`
    );

    // 更新versionCode
    const versionCodeMatch = buildGradle.match(/versionCode\s+(\d+)/);
    if (versionCodeMatch) {
      const currentCode = parseInt(versionCodeMatch[1]);
      buildGradle = buildGradle.replace(
        /versionCode\s+\d+/,
        `versionCode ${currentCode + 1}`
      );
    }

    fs.writeFileSync(buildGradlePath, buildGradle);
  }

  updateiOSVersion(version) {
    const infoPlistPath = path.join(__dirname, '../ios/MyApp/Info.plist');
    let infoPlist = fs.readFileSync(infoPlistPath, 'utf8');

    // 更新CFBundleShortVersionString
    infoPlist = infoPlist.replace(
      /<key>CFBundleShortVersionString<\/key>\s*<string>[^<]*<\/string>/,
      `<key>CFBundleShortVersionString</key>\n\t<string>${version}</string>`
    );

    fs.writeFileSync(infoPlistPath, infoPlist);
  }

  async buildApp() {
    console.log(`构建 ${this.platform} 应用...`);

    if (this.platform === 'android') {
      execSync('cd android && ./gradlew bundleRelease', { stdio: 'inherit' });
    } else if (this.platform === 'ios') {
      execSync(
        'xcodebuild -workspace ios/MyApp.xcworkspace -scheme MyApp -configuration Release archive -archivePath ios/build/MyApp.xcarchive',
        { stdio: 'inherit' }
      );
    }
  }

  async runTests() {
    console.log('运行测试...');
    execSync('npm test', { stdio: 'inherit' });
  }

  async uploadToStore() {
    console.log(`上传到 ${this.platform} 应用商店...`);

    if (this.platform === 'android') {
      // 使用Google Play Console API或fastlane
      execSync('fastlane android deploy', { stdio: 'inherit' });
    } else if (this.platform === 'ios') {
      // 使用App Store Connect API或fastlane
      execSync('fastlane ios deploy', { stdio: 'inherit' });
    }
  }
}

// 使用示例
const platform = process.argv[2];
if (!platform || !['android', 'ios'].includes(platform)) {
  console.error('请指定平台: node scripts/release.js [android|ios]');
  process.exit(1);
}

const releaseManager = new ReleaseManager(platform);
releaseManager.release();
```

### Flutter应用发布

```yaml
# pubspec.yaml版本配置
name: my_flutter_app
description: A new Flutter project.
version: 1.0.0+1

# 构建配置
flutter:
  uses-material-design: true
  assets:
    - assets/images/
    - assets/icons/
```

```bash
# 1. Android发布
# 配置android/key.properties
storePassword=<password>
keyPassword=<password>
keyAlias=<alias>
storeFile=<keystore-file>

# 构建APK
flutter build apk --release

# 构建App Bundle (推荐)
flutter build appbundle --release

# 2. iOS发布
# 构建iOS应用
flutter build ios --release

# 使用Xcode Archive
open ios/Runner.xcworkspace
```

```dart
// 3. 版本管理和更新检查
class AppUpdateService {
  static const String _currentVersion = '1.0.0';
  static const String _updateCheckUrl = 'https://api.example.com/app/version';

  static Future<UpdateInfo?> checkForUpdate() async {
    try {
      final response = await http.get(Uri.parse(_updateCheckUrl));
      if (response.statusCode == 200) {
        final data = json.decode(response.body);
        final latestVersion = data['latest_version'];
        final isForceUpdate = data['force_update'] ?? false;

        if (_isNewerVersion(latestVersion, _currentVersion)) {
          return UpdateInfo(
            latestVersion: latestVersion,
            currentVersion: _currentVersion,
            isForceUpdate: isForceUpdate,
            downloadUrl: data['download_url'],
            releaseNotes: data['release_notes'],
          );
        }
      }
    } catch (e) {
      print('检查更新失败: $e');
    }
    return null;
  }

  static bool _isNewerVersion(String latest, String current) {
    final latestParts = latest.split('.').map(int.parse).toList();
    final currentParts = current.split('.').map(int.parse).toList();

    for (int i = 0; i < latestParts.length; i++) {
      if (i >= currentParts.length) return true;
      if (latestParts[i] > currentParts[i]) return true;
      if (latestParts[i] < currentParts[i]) return false;
    }
    return false;
  }

  static Future<void> showUpdateDialog(
    BuildContext context,
    UpdateInfo updateInfo,
  ) async {
    return showDialog(
      context: context,
      barrierDismissible: !updateInfo.isForceUpdate,
      builder: (context) => AlertDialog(
        title: Text('发现新版本'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text('当前版本: ${updateInfo.currentVersion}'),
            Text('最新版本: ${updateInfo.latestVersion}'),
            SizedBox(height: 16),
            Text('更新内容:'),
            Text(updateInfo.releaseNotes),
          ],
        ),
        actions: [
          if (!updateInfo.isForceUpdate)
            TextButton(
              onPressed: () => Navigator.pop(context),
              child: Text('稍后更新'),
            ),
          ElevatedButton(
            onPressed: () => _launchUpdate(updateInfo.downloadUrl),
            child: Text('立即更新'),
          ),
        ],
      ),
    );
  }

  static void _launchUpdate(String downloadUrl) {
    // 启动应用商店或下载页面
    launch(downloadUrl);
  }
}

class UpdateInfo {
  final String latestVersion;
  final String currentVersion;
  final bool isForceUpdate;
  final String downloadUrl;
  final String releaseNotes;

  UpdateInfo({
    required this.latestVersion,
    required this.currentVersion,
    required this.isForceUpdate,
    required this.downloadUrl,
    required this.releaseNotes,
  });
}
```

---

<Callout type="success">
移动端开发技术为前端开发者提供了进入移动应用领域的机会，通过跨平台框架可以高效地开发出优质的移动应用。
</Callout>

---

## 📚 参考学习资料

### 📖 官方文档
- [React Native 官方文档](https://reactnative.dev/) - React Native权威学习资源
- [Flutter 官方文档](https://flutter.dev/) - Flutter开发指南
- [Expo 文档](https://docs.expo.dev/) - Expo开发平台
- [Ionic 文档](https://ionicframework.com/docs) - Ionic跨平台框架

### 🎓 优质教程
- [React Native 官方教程](https://reactnative.dev/docs/tutorial) - 官方入门教程
- [Flutter Codelabs](https://codelabs.developers.google.com/codelabs/flutter) - Google官方实验室
- [Mobile Development Courses](https://www.udacity.com/course/react-native--ud905) - 移动开发课程

### 🛠️ 实践项目
- [React Native Examples](https://github.com/ReactNativeNews/React-Native-Apps) - React Native应用示例
- [Flutter Samples](https://github.com/flutter/samples) - Flutter官方示例
- [Awesome React Native](https://github.com/jondot/awesome-react-native) - React Native资源集合

### 🔧 开发工具
- [React Native CLI](https://reactnative.dev/docs/environment-setup) - React Native命令行工具
- [Flutter SDK](https://flutter.dev/docs/get-started/install) - Flutter开发工具包
- [Android Studio](https://developer.android.com/studio) - Android开发IDE
- [Xcode](https://developer.apple.com/xcode/) - iOS开发IDE

### 📝 深入阅读
- [React Native Performance](https://reactnative.dev/docs/performance) - React Native性能优化
- [Flutter Performance](https://flutter.dev/docs/perf) - Flutter性能最佳实践
- [Mobile App Architecture](https://developer.android.com/jetpack/guide) - 移动应用架构指南

<Callout type="tip">
💡 **学习建议**：建议从React Native或Flutter中选择一个开始学习，掌握基础开发后再学习原生模块开发，最后了解应用发布和性能优化。
</Callout>
