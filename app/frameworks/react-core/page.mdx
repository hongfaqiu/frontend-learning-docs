import { Callout } from 'nextra/components'

# 07. Reactæ ¸å¿ƒåŸç†å’Œç”Ÿæ€

## ğŸ“‹ ç›®å½•

- [Reactæ¶æ„æ·±åº¦è§£æ](#reactæ¶æ„æ·±åº¦è§£æ)
- [Fiberæ¶æ„å’Œè°ƒåº¦æœºåˆ¶](#fiberæ¶æ„å’Œè°ƒåº¦æœºåˆ¶)
- [HooksåŸç†å’Œæœ€ä½³å®è·µ](#hooksåŸç†å’Œæœ€ä½³å®è·µ)
- [çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”](#çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”)
- [Reactæ€§èƒ½ä¼˜åŒ–](#reactæ€§èƒ½ä¼˜åŒ–)
- [Reactç”Ÿæ€å·¥å…·é“¾](#reactç”Ÿæ€å·¥å…·é“¾)

## Reactæ¶æ„æ·±åº¦è§£æ

<Callout type="info">
[React](https://react.dev/)çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†UIè§†ä¸ºå‡½æ•°çš„çº¯ç²¹è¾“å‡ºï¼Œé€šè¿‡å£°æ˜å¼ç¼–ç¨‹å’Œç»„ä»¶åŒ–æ€æƒ³æ„å»ºç”¨æˆ·ç•Œé¢ã€‚
</Callout>

### Reactæ ¸å¿ƒæ¦‚å¿µ

#### Reactè®¾è®¡ç†å¿µ

| æ¦‚å¿µ | è¯´æ˜ | ç‰¹ç‚¹ | ä¼˜åŠ¿ |
|------|------|------|------|
| **UI = f(state)** | UIæ˜¯çŠ¶æ€çš„çº¯å‡½æ•° | å£°æ˜å¼ç¼–ç¨‹ | å¯é¢„æµ‹ã€æ˜“è°ƒè¯• |
| **ç»„ä»¶åŒ–** | å°†UIæ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶ | å¯å¤ç”¨ã€å¯ç»„åˆ | æé«˜å¼€å‘æ•ˆç‡ |
| **Virtual DOM** | è™šæ‹ŸDOMæŠ½è±¡å±‚ | å†…å­˜ä¸­çš„JSå¯¹è±¡ | æ€§èƒ½ä¼˜åŒ–ã€è·¨å¹³å° |
| **å•å‘æ•°æ®æµ** | æ•°æ®ä»ä¸Šåˆ°ä¸‹æµåŠ¨ | æ•°æ®æµæ¸…æ™° | æ˜“äºç†è§£å’Œç»´æŠ¤ |

#### æ ¸å¿ƒæ¦‚å¿µç¤ºä¾‹

```jsx
// 1. å‡½æ•°å¼ç»„ä»¶çš„æœ¬è´¨
function MyComponent(props) {
  // è¿™å°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼šç›¸åŒè¾“å…¥ -> ç›¸åŒè¾“å‡º
  return <div>{props.children}</div>;
}

// 2. JSXç¼–è¯‘è¿‡ç¨‹
// JSXè¯­æ³•ç³–
const element = <h1 className="greeting">Hello, world!</h1>;

// ç¼–è¯‘åçš„çœŸå®ä»£ç 
const element = React.createElement(
  'h1',
  { className: 'greeting' },
  'Hello, world!'
);

// 3. Virtual DOMç»“æ„
const virtualDOM = {
  type: 'h1',
  props: {
    className: 'greeting',
    children: 'Hello, world!'
  },
  key: null,
  ref: null
};
```

#### Reactæ ¸å¿ƒç‰¹æ€§

- **å£°æ˜å¼**ï¼šæè¿°UIåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œè€Œä¸æ˜¯å¦‚ä½•æ“ä½œDOM
- **ç»„ä»¶åŒ–**ï¼šå°†å¤æ‚UIæ‹†åˆ†ä¸ºç®€å•ã€å¯å¤ç”¨çš„ç»„ä»¶
- **ä¸€æ¬¡å­¦ä¹ ï¼Œéšå¤„ç¼–å†™**ï¼šReact Nativeã€React Server Componentsç­‰
- **è™šæ‹ŸDOM**ï¼šæä¾›æ€§èƒ½ä¼˜åŒ–å’Œè·¨å¹³å°èƒ½åŠ›

### Reactæ¸²æŸ“æµç¨‹

<Callout type="warning">
ç†è§£Reactçš„æ¸²æŸ“æµç¨‹å¯¹äºç¼–å†™é«˜æ€§èƒ½çš„Reactåº”ç”¨è‡³å…³é‡è¦ã€‚Reactçš„æ¸²æŸ“è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªä¸»è¦é˜¶æ®µã€‚
</Callout>

#### Reactæ¸²æŸ“ä¸‰é˜¶æ®µ

| é˜¶æ®µ | ç‰¹æ€§ | ä¸»è¦å·¥ä½œ | å¯ä¸­æ–­æ€§ |
|------|------|----------|----------|
| **Render Phase** | çº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ | æ„å»ºFiberæ ‘ã€æ‰§è¡Œç»„ä»¶å‡½æ•°ã€Diffing | âœ… å¯ä¸­æ–­ |
| **Commit Phase** | æ“ä½œDOM | DOMæ›´æ–°ã€ç”Ÿå‘½å‘¨æœŸã€useLayoutEffect | âŒ ä¸å¯ä¸­æ–­ |
| **Passive Effects** | å¼‚æ­¥æ‰§è¡Œ | useEffectå›è°ƒ | âœ… å¯å»¶è¿Ÿ |

#### æ›´æ–°è§¦å‘æ–¹å¼

| è§¦å‘æ–¹å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|----------|------|------|
| **é¦–æ¬¡æ¸²æŸ“** | ç»„ä»¶é¦–æ¬¡æŒ‚è½½ | `ReactDOM.render()` |
| **çŠ¶æ€æ›´æ–°** | setState/useState | `setCount(count + 1)` |
| **å¼ºåˆ¶æ›´æ–°** | è·³è¿‡shouldComponentUpdate | `forceUpdate()` |
| **çˆ¶ç»„ä»¶æ›´æ–°** | çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ | propså˜åŒ– |

#### æ¸²æŸ“æµç¨‹ç¤ºä¾‹

```jsx
// æ¸²æŸ“æµç¨‹ç¤ºä¾‹
function Counter() {
  console.log("1. ç»„ä»¶å‡½æ•°æ‰§è¡Œ"); // Renderé˜¶æ®µ

  const [count, setCount] = useState(0);

  useLayoutEffect(() => {
    console.log("3. useLayoutEffectæ‰§è¡Œ"); // Commité˜¶æ®µ
  });

  useEffect(() => {
    console.log("4. useEffectæ‰§è¡Œ"); // Passive Effectsé˜¶æ®µ
  });

  return (
    <div>
      <p>{count}</p>
      <button onClick={() => setCount(count + 1)}>
        å¢åŠ 
      </button>
    </div>
  );
}

// æ‰§è¡Œé¡ºåºï¼š
// 1. ç»„ä»¶å‡½æ•°æ‰§è¡Œ (Render)
// 2. DOMæ›´æ–° (Commit)
// 3. useLayoutEffectæ‰§è¡Œ (Commit)
// 4. useEffectæ‰§è¡Œ (Passive Effects)
```

## Fiberæ¶æ„å’Œè°ƒåº¦æœºåˆ¶

<Callout type="info">
Fiberæ¶æ„æ˜¯React 16å¼•å…¥çš„é‡å¤§æ¶æ„å‡çº§ï¼Œå®ƒä½¿Reactèƒ½å¤Ÿå®ç°å¯ä¸­æ–­çš„æ¸²æŸ“å’Œä¼˜å…ˆçº§è°ƒåº¦ã€‚
</Callout>

#### Fiberæ¶æ„ä¼˜åŠ¿

| ç‰¹æ€§ | React 15 (Stack) | React 16+ (Fiber) | ä¼˜åŠ¿ |
|------|------------------|-------------------|------|
| **æ¸²æŸ“æ–¹å¼** | åŒæ­¥é€’å½’ | å¯ä¸­æ–­æ¸²æŸ“ | é¿å…é•¿æ—¶é—´é˜»å¡ |
| **ä¼˜å…ˆçº§è°ƒåº¦** | æ—  | æ”¯æŒä¼˜å…ˆçº§ | é‡è¦æ›´æ–°ä¼˜å…ˆå¤„ç† |
| **é”™è¯¯è¾¹ç•Œ** | æœ‰é™æ”¯æŒ | å®Œæ•´æ”¯æŒ | æ›´å¥½çš„é”™è¯¯å¤„ç† |
| **å¹¶å‘ç‰¹æ€§** | ä¸æ”¯æŒ | æ”¯æŒ | Suspenseã€å¹¶å‘æ¸²æŸ“ |

#### FiberèŠ‚ç‚¹ç»“æ„

```javascript
// FiberèŠ‚ç‚¹çš„æ ¸å¿ƒç»“æ„
const FiberNode = {
  // èŠ‚ç‚¹ä¿¡æ¯
  type: null,          // ç»„ä»¶ç±»å‹
  key: null,           // React key
  stateNode: null,     // DOMèŠ‚ç‚¹æˆ–ç»„ä»¶å®ä¾‹

  // æ ‘ç»“æ„
  return: null,        // çˆ¶èŠ‚ç‚¹
  child: null,         // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
  sibling: null,       // å…„å¼ŸèŠ‚ç‚¹

  // çŠ¶æ€ç®¡ç†
  pendingProps: null,  // æ–°props
  memoizedProps: null, // æ—§props
  memoizedState: null, // æ—§state
  updateQueue: null,   // æ›´æ–°é˜Ÿåˆ—

  // è°ƒåº¦ç›¸å…³
  lanes: NoLanes,      // ä¼˜å…ˆçº§
  flags: NoFlags,      // å‰¯ä½œç”¨æ ‡è®°
  alternate: null      // åŒç¼“å­˜æŒ‡é’ˆ
};
```

#### æ—¶é—´åˆ‡ç‰‡æœºåˆ¶

```javascript
// æ—¶é—´åˆ‡ç‰‡ç¤ºä¾‹
function workLoopConcurrent() {
  // åœ¨æœ‰å‰©ä½™æ—¶é—´æ—¶ç»§ç»­å·¥ä½œ
  while (workInProgress !== null && !shouldYield()) {
    performUnitOfWork(workInProgress);
  }
}

function shouldYield() {
  // æ£€æŸ¥æ˜¯å¦åº”è¯¥è®©å‡ºæ§åˆ¶æƒ
  return getCurrentTime() >= deadline;
}
```
```

#### ä¼˜å…ˆçº§è°ƒåº¦

| ä¼˜å…ˆçº§ | å€¼ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|--------|----|---------|----- |
| **Immediate** | 1 | ç«‹å³æ‰§è¡Œ | ç”¨æˆ·è¾“å…¥ã€focusäº‹ä»¶ |
| **UserBlocking** | 2 | ç”¨æˆ·é˜»å¡ | ç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ |
| **Normal** | 3 | æ­£å¸¸ä¼˜å…ˆçº§ | ç½‘ç»œè¯·æ±‚ã€æ•°æ®æ›´æ–° |
| **Low** | 4 | ä½ä¼˜å…ˆçº§ | åˆ†æç»Ÿè®¡ã€æ—¥å¿— |
| **Idle** | 5 | ç©ºé—²æ—¶æ‰§è¡Œ | é¢„åŠ è½½ã€ç¼“å­˜æ¸…ç† |

## HooksåŸç†å’Œæœ€ä½³å®è·µ

### Hookså®ç°åŸç†

<Callout type="warning">
Hooksçš„å®ç°åŸºäºé“¾è¡¨ç»“æ„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆHookså¿…é¡»åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ã€‚
</Callout>

#### Hooksè§„åˆ™

| è§„åˆ™ | è¯´æ˜ | åŸå›  | æ­£ç¡®ç¤ºä¾‹ |
|------|------|------|----------|
| **é¡¶å±‚è°ƒç”¨** | åªåœ¨å‡½æ•°é¡¶å±‚è°ƒç”¨Hooks | ä¿è¯è°ƒç”¨é¡ºåºä¸€è‡´ | `const [state, setState] = useState()` |
| **Reactå‡½æ•°ä¸­è°ƒç”¨** | åªåœ¨Reactå‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰Hookä¸­è°ƒç”¨ | ç¡®ä¿åœ¨Reactä¸Šä¸‹æ–‡ä¸­ | å‡½æ•°ç»„ä»¶ã€è‡ªå®šä¹‰Hook |
| **ä¸åœ¨å¾ªç¯/æ¡ä»¶ä¸­** | ä¸åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ | ä¿è¯æ¯æ¬¡æ¸²æŸ“è°ƒç”¨é¡ºåºç›¸åŒ | é¿å…`if (condition) useState()` |

#### Hookså®ç°åŸç†

```javascript
// useStateç®€åŒ–å®ç°
let hookIndex = 0;
let hooks = [];

function useState(initialValue) {
  const currentIndex = hookIndex;

  // åˆå§‹åŒ–hook
  if (hooks[currentIndex] === undefined) {
    hooks[currentIndex] = {
      state: initialValue,
      queue: []
    };
  }

  const hook = hooks[currentIndex];

  // å¤„ç†æ›´æ–°é˜Ÿåˆ—
  hook.queue.forEach(action => {
    hook.state = typeof action === 'function' ? action(hook.state) : action;
  });
  hook.queue = [];

  const setState = (action) => {
    hook.queue.push(action);
    rerender(); // è§¦å‘é‡æ–°æ¸²æŸ“
  };

  hookIndex++;
  return [hook.state, setState];
}

// useEffectç®€åŒ–å®ç°
function useEffect(callback, deps) {
  const currentIndex = hookIndex;

  if (hooks[currentIndex] === undefined) {
    hooks[currentIndex] = { callback, deps, cleanup: null };
    hooks[currentIndex].cleanup = callback(); // é¦–æ¬¡æ‰§è¡Œ
  } else {
    const hook = hooks[currentIndex];

    // æ£€æŸ¥ä¾èµ–å˜åŒ–
    const depsChanged = deps ?
      !deps.every((dep, i) => dep === hook.deps[i]) : true;

    if (depsChanged) {
      if (hook.cleanup) hook.cleanup(); // æ¸…ç†
      hook.cleanup = callback(); // æ‰§è¡Œæ–°å‰¯ä½œç”¨
      hook.deps = deps;
    }
  }

  hookIndex++;
}
```

#### å¸¸ç”¨Hookså¯¹æ¯”

| Hook | ç”¨é€” | è¿”å›å€¼ | ä½¿ç”¨åœºæ™¯ |
|------|------|--------|----------|
| **useState** | çŠ¶æ€ç®¡ç† | `[state, setState]` | ç»„ä»¶å†…éƒ¨çŠ¶æ€ |
| **useEffect** | å‰¯ä½œç”¨å¤„ç† | `undefined` | æ•°æ®è·å–ã€è®¢é˜…ã€DOMæ“ä½œ |
| **useContext** | ä¸Šä¸‹æ–‡æ¶ˆè´¹ | `contextValue` | è·¨ç»„ä»¶æ•°æ®ä¼ é€’ |
| **useReducer** | å¤æ‚çŠ¶æ€ç®¡ç† | `[state, dispatch]` | å¤æ‚çŠ¶æ€é€»è¾‘ |
| **useMemo** | å€¼ç¼“å­˜ | `memoizedValue` | æ˜‚è´µè®¡ç®—ä¼˜åŒ– |
| **useCallback** | å‡½æ•°ç¼“å­˜ | `memoizedCallback` | å‡½æ•°å¼•ç”¨ä¼˜åŒ– |

### è‡ªå®šä¹‰Hooksæœ€ä½³å®è·µ

#### å¸¸ç”¨è‡ªå®šä¹‰Hooks

| Hookåç§° | åŠŸèƒ½ | è¿”å›å€¼ | ä½¿ç”¨åœºæ™¯ |
|----------|------|--------|----------|
| **useLocalStorage** | æœ¬åœ°å­˜å‚¨åŒæ­¥ | `[value, setValue]` | ç”¨æˆ·åå¥½è®¾ç½® |
| **useDebounce** | é˜²æŠ–å¤„ç† | `debouncedValue` | æœç´¢è¾“å…¥ |
| **useAsync** | å¼‚æ­¥çŠ¶æ€ç®¡ç† | `{data, loading, error}` | APIè°ƒç”¨ |
| **useToggle** | å¸ƒå°”å€¼åˆ‡æ¢ | `[value, toggle]` | å¼€å…³çŠ¶æ€ |

#### è‡ªå®šä¹‰Hooksç¤ºä¾‹

```javascript
// 1. useLocalStorage - æœ¬åœ°å­˜å‚¨Hook
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });

  const setValue = useCallback((value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(`Error setting localStorage:`, error);
    }
  }, [key, storedValue]);

  return [storedValue, setValue];
}

// 2. useDebounce - é˜²æŠ–Hook
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => setDebouncedValue(value), delay);
    return () => clearTimeout(handler);
  }, [value, delay]);

  return debouncedValue;
}

// 3. useAsync - å¼‚æ­¥çŠ¶æ€ç®¡ç†Hook
function useAsync(asyncFunction, dependencies = []) {
  const [state, setState] = useState({
    data: null,
    loading: false,
    error: null
  });

  useEffect(() => {
    let cancelled = false;
    setState({ data: null, loading: true, error: null });

    asyncFunction()
      .then(data => !cancelled && setState({ data, loading: false, error: null }))
      .catch(error => !cancelled && setState({ data: null, loading: false, error }));

    return () => { cancelled = true; };
  }, dependencies);

  return state;
}
```

#### è‡ªå®šä¹‰Hooksè®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªHookåªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¯å¤ç”¨æ€§**ï¼šè®¾è®¡é€šç”¨çš„å‚æ•°æ¥å£
- **é”™è¯¯å¤„ç†**ï¼šæä¾›å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨useMemoå’ŒuseCallbackä¼˜åŒ–æ€§èƒ½
- **æ¸…ç†èµ„æº**ï¼šåœ¨useEffectä¸­æ­£ç¡®æ¸…ç†å‰¯ä½œç”¨

## çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”

### Reactå†…ç½®çŠ¶æ€ç®¡ç†

#### useState vs useReducer

| ç‰¹æ€§ | useState | useReducer | é€‚ç”¨åœºæ™¯ |
|------|----------|------------|----------|
| **å¤æ‚åº¦** | ç®€å• | å¤æ‚ | useStateé€‚åˆç®€å•çŠ¶æ€ï¼ŒuseReduceré€‚åˆå¤æ‚çŠ¶æ€é€»è¾‘ |
| **çŠ¶æ€æ›´æ–°** | ç›´æ¥è®¾ç½® | é€šè¿‡action | useReduceræ›´é€‚åˆå¤šç§çŠ¶æ€å˜æ›´æ–¹å¼ |
| **å¯é¢„æµ‹æ€§** | ä¸€èˆ¬ | é«˜ | useReducerçš„çŠ¶æ€å˜æ›´æ›´å¯é¢„æµ‹ |
| **è°ƒè¯•** | ç®€å• | å®¹æ˜“è¿½è¸ª | useReducerä¾¿äºè°ƒè¯•çŠ¶æ€å˜æ›´ |



### Redux vs Zustand vs Jotai

```javascript
// 1. Redux + Redux Toolkit
import { createSlice, configureStore } from '@reduxjs/toolkit';

const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action) => {
      state.value += action.payload;
    }
  }
});

const store = configureStore({
  reducer: {
    counter: counterSlice.reducer
  }
});

// 2. Zustand
import { create } from 'zustand';

const useCounterStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
  decrement: () => set((state) => ({ count: state.count - 1 })),
  reset: () => set({ count: 0 })
}));

// 3. Jotai
import { atom, useAtom } from 'jotai';

const countAtom = atom(0);
const doubleCountAtom = atom((get) => get(countAtom) * 2);

function JotaiCounter() {
  const [count, setCount] = useAtom(countAtom);
  const [doubleCount] = useAtom(doubleCountAtom);

  return (
    <div>
      <span>Count: {count}</span>
      <span>Double: {doubleCount}</span>
      <button onClick={() => setCount(c => c + 1)}>+</button>
    </div>
  );
}
```

### çŠ¶æ€ç®¡ç†æ–¹æ¡ˆé€‰æ‹©æŒ‡å—

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| **Redux** | å¤§å‹å¤æ‚åº”ç”¨ | å¯é¢„æµ‹ã€è°ƒè¯•å·¥å…·å¼ºå¤§ | æ ·æ¿ä»£ç å¤šã€å­¦ä¹ æ›²çº¿é™¡ |
| **Zustand** | ä¸­å°å‹åº”ç”¨ | è½»é‡ã€APIç®€å• | ç”Ÿæ€ç›¸å¯¹è¾ƒå° |
| **Jotai** | éœ€è¦ç»†ç²’åº¦æ§åˆ¶ | åŸå­åŒ–ã€é¿å…ä¸å¿…è¦é‡æ¸²æŸ“ | æ¦‚å¿µç›¸å¯¹æ–°é¢– |
| **Context** | ç®€å•å…¨å±€çŠ¶æ€ | Reactå†…ç½®ã€æ— éœ€ä¾èµ– | æ€§èƒ½é—®é¢˜ã€ä¸é€‚åˆé¢‘ç¹æ›´æ–° |

## Reactæ€§èƒ½ä¼˜åŒ–

### ç»„ä»¶ä¼˜åŒ–æŠ€å·§

```jsx
// 1. React.memo - ç»„ä»¶è®°å¿†åŒ–
const ExpensiveComponent = React.memo(({ data, onUpdate }) => {
  console.log('ExpensiveComponent é‡æ–°æ¸²æŸ“');
  
  return (
    <div>
      {data.map(item => (
        <div key={item.id}>{item.name}</div>
      ))}
    </div>
  );
}, (prevProps, nextProps) => {
  // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
  return prevProps.data.length === nextProps.data.length &&
         prevProps.onUpdate === nextProps.onUpdate;
});

// 2. useMemo - å€¼è®°å¿†åŒ–
function DataProcessor({ items, filter }) {
  const expensiveValue = useMemo(() => {
    console.log('è®¡ç®—æ˜‚è´µçš„å€¼');
    return items
      .filter(item => item.category === filter)
      .reduce((sum, item) => sum + item.value, 0);
  }, [items, filter]);

  return <div>æ€»è®¡: {expensiveValue}</div>;
}

// 3. useCallback - å‡½æ•°è®°å¿†åŒ–
function ParentComponent() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');

  // æ²¡æœ‰useCallbackï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°å‡½æ•°
  const handleClick = useCallback(() => {
    console.log('æŒ‰é’®è¢«ç‚¹å‡»');
  }, []); // ç©ºä¾èµ–æ•°ç»„ï¼Œå‡½æ•°æ°¸è¿œä¸ä¼šæ”¹å˜

  const handleNameChange = useCallback((newName) => {
    setName(newName);
  }, []); // ä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼Œé¿å…ä¾èµ–name

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(c => c + 1)}>å¢åŠ </button>
      
      <ExpensiveChild 
        onClick={handleClick}
        onNameChange={handleNameChange}
      />
    </div>
  );
}

// 4. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
const LazyComponent = React.lazy(() => import('./LazyComponent'));

function App() {
  return (
    <div>
      <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
        <LazyComponent />
      </Suspense>
    </div>
  );
}

// 5. è™šæ‹Ÿæ»šåŠ¨
function VirtualList({ items, itemHeight = 50 }) {
  const [scrollTop, setScrollTop] = useState(0);
  const containerHeight = 400;
  const visibleCount = Math.ceil(containerHeight / itemHeight);
  const startIndex = Math.floor(scrollTop / itemHeight);
  const endIndex = Math.min(startIndex + visibleCount, items.length);
  
  const visibleItems = items.slice(startIndex, endIndex);
  
  return (
    <div 
      style={{ height: containerHeight, overflow: 'auto' }}
      onScroll={(e) => setScrollTop(e.target.scrollTop)}
    >
      <div style={{ height: items.length * itemHeight, position: 'relative' }}>
        {visibleItems.map((item, index) => (
          <div
            key={startIndex + index}
            style={{
              position: 'absolute',
              top: (startIndex + index) * itemHeight,
              height: itemHeight,
              width: '100%'
            }}
          >
            {item.name}
          </div>
        ))}
      </div>
    </div>
  );
}
```

## Reactç”Ÿæ€å·¥å…·é“¾

<Callout type="info">
[React](https://react.dev/)æ‹¥æœ‰ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¼€å‘å·¥å…·ã€çŠ¶æ€ç®¡ç†ã€è·¯ç”±ã€æµ‹è¯•ç­‰å„ä¸ªæ–¹é¢çš„è§£å†³æ–¹æ¡ˆã€‚
</Callout>

### å¼€å‘å·¥å…·

```bash
# Create React App - å®˜æ–¹è„šæ‰‹æ¶
npx create-react-app my-app
cd my-app
npm start

# Vite + React - ç°ä»£æ„å»ºå·¥å…·
npm create vite@latest my-react-app -- --template react
cd my-react-app
npm install
npm run dev

# Next.js - å…¨æ ˆReactæ¡†æ¶
npx create-next-app@latest my-next-app
cd my-next-app
npm run dev
```

### çŠ¶æ€ç®¡ç†å·¥å…·

```javascript
// Redux Toolkit - ç°ä»£Redux
import { createSlice, configureStore } from '@reduxjs/toolkit';

const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    }
  }
});

export const { increment, decrement } = counterSlice.actions;
export const store = configureStore({
  reducer: {
    counter: counterSlice.reducer
  }
});

// Zustand - è½»é‡çº§çŠ¶æ€ç®¡ç†
import { create } from 'zustand';

const useStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
  decrement: () => set((state) => ({ count: state.count - 1 }))
}));
```

### è·¯ç”±ç®¡ç†

```javascript
// React Router v6
import { BrowserRouter, Routes, Route, Link } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <nav>
        <Link to="/">Home</Link>
        <Link to="/about">About</Link>
        <Link to="/contact">Contact</Link>
      </nav>

      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/contact" element={<Contact />} />
        <Route path="/users/:id" element={<UserProfile />} />
      </Routes>
    </BrowserRouter>
  );
}
```

### UIç»„ä»¶åº“

```javascript
// Ant Design
import { Button, Table, Form, Input } from 'antd';

function MyComponent() {
  return (
    <Form>
      <Form.Item label="ç”¨æˆ·å" name="username">
        <Input />
      </Form.Item>
      <Button type="primary" htmlType="submit">
        æäº¤
      </Button>
    </Form>
  );
}

// Material-UI (MUI)
import { Button, TextField, Box } from '@mui/material';

function MyComponent() {
  return (
    <Box component="form">
      <TextField label="ç”¨æˆ·å" variant="outlined" />
      <Button variant="contained" color="primary">
        æäº¤
      </Button>
    </Box>
  );
}
```

### æµ‹è¯•å·¥å…·

```javascript
// Jest + React Testing Library
import { render, screen, fireEvent } from '@testing-library/react';
import '@testing-library/jest-dom';
import Counter from './Counter';

test('renders counter and increments', () => {
  render(<Counter />);

  const counter = screen.getByText(/count: 0/i);
  expect(counter).toBeInTheDocument();

  const button = screen.getByRole('button', { name: /increment/i });
  fireEvent.click(button);

  expect(screen.getByText(/count: 1/i)).toBeInTheDocument();
});

// Cypress E2Eæµ‹è¯•
describe('Counter App', () => {
  it('should increment counter', () => {
    cy.visit('/');
    cy.contains('Count: 0');
    cy.get('[data-testid="increment-button"]').click();
    cy.contains('Count: 1');
  });
});
```

---

<Callout type="success">
ç†è§£Reactçš„æ ¸å¿ƒåŸç†å’ŒFiberæ¶æ„æ˜¯æˆä¸ºReacté«˜çº§å¼€å‘è€…çš„å…³é”®ã€‚è¿™äº›çŸ¥è¯†å°†å¸®åŠ©ä½ ç¼–å†™æ›´é«˜æ•ˆã€æ›´å¯ç»´æŠ¤çš„Reactåº”ç”¨ã€‚
</Callout>

---

## ğŸ“š å‚è€ƒå­¦ä¹ èµ„æ–™

### ğŸ“– å®˜æ–¹æ–‡æ¡£
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/) - Reactå®˜æ–¹å­¦ä¹ èµ„æº
- [React API å‚è€ƒ](https://react.dev/reference/react) - å®Œæ•´APIæ–‡æ¡£
- [React DevTools](https://react.dev/learn/react-developer-tools) - å®˜æ–¹è°ƒè¯•å·¥å…·

### ğŸ“ ä¼˜è´¨æ•™ç¨‹
- [React å®˜æ–¹æ•™ç¨‹](https://react.dev/learn) - å®˜æ–¹å…¥é—¨æ•™ç¨‹
- [React Patterns](https://reactpatterns.com/) - Reactè®¾è®¡æ¨¡å¼
- [Epic React](https://epicreact.dev/) - Kent C. Doddsçš„Reactè¯¾ç¨‹

### ğŸ› ï¸ å®è·µé¡¹ç›®
- [React é¡¹ç›®é›†åˆ](https://github.com/facebook/create-react-app) - å®˜æ–¹è„šæ‰‹æ¶
- [React ç¤ºä¾‹é¡¹ç›®](https://github.com/facebook/react/tree/main/packages/react-dom/src/__tests__) - å®˜æ–¹ç¤ºä¾‹
- [Awesome React](https://github.com/enaqx/awesome-react) - Reactèµ„æºé›†åˆ

### ğŸ”§ å¼€å‘å·¥å…·
- [Create React App](https://create-react-app.dev/) - å®˜æ–¹è„šæ‰‹æ¶
- [Vite React æ¨¡æ¿](https://vitejs.dev/guide/#trying-vite-online) - ç°ä»£æ„å»ºå·¥å…·
- [React DevTools](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi) - æµè§ˆå™¨æ‰©å±•

### ğŸ“ æ·±å…¥é˜…è¯»
- [React Fiber æ¶æ„](https://github.com/acdlite/react-fiber-architecture) - FiberåŸç†è§£æ
- [React æºç è§£æ](https://react.iamkasong.com/) - æºç å­¦ä¹ æŒ‡å—
- [React æ€§èƒ½ä¼˜åŒ–](https://web.dev/react/) - Google Web.dev ReactæŒ‡å—

<Callout type="tip">
ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå»ºè®®ä»å®˜æ–¹æ–‡æ¡£å¼€å§‹ï¼Œé€šè¿‡Create React Appåˆ›å»ºé¡¹ç›®å®è·µï¼Œç„¶åæ·±å…¥å­¦ä¹ Hookså’Œæ€§èƒ½ä¼˜åŒ–ï¼Œæœ€åäº†è§£Fiberæ¶æ„åŸç†ã€‚
</Callout>
