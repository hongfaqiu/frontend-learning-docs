import { Callout } from 'nextra/components'

# 12. å°ç¨‹åºå’Œè·¨ç«¯å¼€å‘

## ğŸ“‹ ç›®å½•

- [å°ç¨‹åºç”Ÿæ€æ¦‚è§ˆ](#å°ç¨‹åºç”Ÿæ€æ¦‚è§ˆ)
- [å¾®ä¿¡å°ç¨‹åºæ·±å…¥å¼€å‘](#å¾®ä¿¡å°ç¨‹åºæ·±å…¥å¼€å‘)
- [è·¨ç«¯æ¡†æ¶å¯¹æ¯”](#è·¨ç«¯æ¡†æ¶å¯¹æ¯”)
- [uni-appå…¨å¹³å°å¼€å‘](#uni-appå…¨å¹³å°å¼€å‘)
- [Taroå¤šç«¯ç»Ÿä¸€å¼€å‘](#taroå¤šç«¯ç»Ÿä¸€å¼€å‘)
- [æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ](#æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ)

## å°ç¨‹åºç”Ÿæ€æ¦‚è§ˆ

<Callout type="info">
å°ç¨‹åºä½œä¸ºè½»é‡çº§åº”ç”¨å½¢æ€ï¼Œåœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚ç†è§£å„å¹³å°å°ç¨‹åºçš„ç‰¹ç‚¹å’Œå¼€å‘æ–¹å¼æ˜¯ç°ä»£å‰ç«¯å¼€å‘è€…çš„å¿…å¤‡æŠ€èƒ½ã€‚
</Callout>

### ä¸»æµå°ç¨‹åºå¹³å°å¯¹æ¯”

```javascript
// å°ç¨‹åºå¹³å°ç‰¹æ€§å¯¹æ¯”
const miniProgramPlatforms = {
  // å¾®ä¿¡å°ç¨‹åº
  wechat: {
    name: 'å¾®ä¿¡å°ç¨‹åº',
    userBase: '12äº¿+',
    features: {
      æ”¯ä»˜: 'å¾®ä¿¡æ”¯ä»˜',
      åˆ†äº«: 'æœ‹å‹åœˆã€ç¾¤èŠ',
      ç™»å½•: 'å¾®ä¿¡æˆæƒç™»å½•',
      åœ°å›¾: 'è…¾è®¯åœ°å›¾',
      ç›´æ’­: 'å°ç¨‹åºç›´æ’­',
      äº‘å¼€å‘: 'å¾®ä¿¡äº‘å¼€å‘'
    },
    limitations: {
      åŒ…å¤§å°: 'ä¸»åŒ…2MBï¼Œåˆ†åŒ…20MB',
      åŸŸå: 'éœ€è¦å¤‡æ¡ˆçš„HTTPSåŸŸå',
      å®¡æ ¸: 'è¾ƒä¸¥æ ¼çš„å®¡æ ¸æœºåˆ¶'
    },
    é€‚ç”¨åœºæ™¯: ['ç”µå•†', 'å·¥å…·', 'å†…å®¹', 'æ¸¸æˆ']
  },
  
  // æ”¯ä»˜å®å°ç¨‹åº
  alipay: {
    name: 'æ”¯ä»˜å®å°ç¨‹åº',
    userBase: '10äº¿+',
    features: {
      æ”¯ä»˜: 'æ”¯ä»˜å®æ”¯ä»˜',
      èŠéº»ä¿¡ç”¨: 'ä¿¡ç”¨è¯„ä¼°',
      ç”Ÿæ´»æœåŠ¡: 'åŸå¸‚æœåŠ¡',
      é‡‘èæœåŠ¡: 'ç†è´¢ã€ä¿é™©'
    },
    limitations: {
      åŒ…å¤§å°: 'ä¸»åŒ…2MBï¼Œåˆ†åŒ…8MB',
      ç”Ÿæ€: 'ç›¸å¯¹å°é—­çš„ç”Ÿæ€'
    },
    é€‚ç”¨åœºæ™¯: ['é‡‘è', 'ç”Ÿæ´»æœåŠ¡', 'æ”¿åŠ¡']
  },
  
  // ç™¾åº¦æ™ºèƒ½å°ç¨‹åº
  baidu: {
    name: 'ç™¾åº¦æ™ºèƒ½å°ç¨‹åº',
    userBase: '5äº¿+',
    features: {
      æœç´¢: 'SEOå‹å¥½',
      AIèƒ½åŠ›: 'è¯­éŸ³ã€å›¾åƒè¯†åˆ«',
      å¼€æ”¾ç”Ÿæ€: 'å¯åœ¨å¤šä¸ªAppä¸­è¿è¡Œ'
    },
    é€‚ç”¨åœºæ™¯: ['å†…å®¹', 'å·¥å…·', 'æœåŠ¡']
  },
  
  // å­—èŠ‚è·³åŠ¨å°ç¨‹åº
  bytedance: {
    name: 'å­—èŠ‚è·³åŠ¨å°ç¨‹åº',
    userBase: '6äº¿+',
    features: {
      æµé‡: 'æŠ–éŸ³ã€ä»Šæ—¥å¤´æ¡æµé‡',
      ç®—æ³•æ¨è: 'æ™ºèƒ½æ¨è',
      çŸ­è§†é¢‘: 'è§†é¢‘èƒ½åŠ›'
    },
    é€‚ç”¨åœºæ™¯: ['å†…å®¹', 'å¨±ä¹', 'ç”µå•†']
  }
};

// è·¨ç«¯å¼€å‘æ¡†æ¶å¯¹æ¯”
const crossPlatformFrameworks = {
  'uni-app': {
    å¼€å‘è¯­è¨€: 'Vue.js',
    æ”¯æŒå¹³å°: ['å¾®ä¿¡', 'æ”¯ä»˜å®', 'ç™¾åº¦', 'å­—èŠ‚è·³åŠ¨', 'QQ', 'H5', 'App'],
    å­¦ä¹ æˆæœ¬: 'ä½ï¼ˆVueå¼€å‘è€…ï¼‰',
    æ€§èƒ½: 'æ¥è¿‘åŸç”Ÿ',
    ç”Ÿæ€: 'ä¸°å¯Œçš„æ’ä»¶å¸‚åœº',
    é€‚åˆå›¢é˜Ÿ: 'VueæŠ€æœ¯æ ˆå›¢é˜Ÿ'
  },
  
  'Taro': {
    å¼€å‘è¯­è¨€: 'React/Vue',
    æ”¯æŒå¹³å°: ['å¾®ä¿¡', 'æ”¯ä»˜å®', 'ç™¾åº¦', 'å­—èŠ‚è·³åŠ¨', 'QQ', 'H5', 'RN'],
    å­¦ä¹ æˆæœ¬: 'ä¸­ç­‰',
    æ€§èƒ½: 'è‰¯å¥½',
    ç”Ÿæ€: 'äº¬ä¸œå›¢é˜Ÿç»´æŠ¤',
    é€‚åˆå›¢é˜Ÿ: 'ReactæŠ€æœ¯æ ˆå›¢é˜Ÿ'
  },
  
  'Remax': {
    å¼€å‘è¯­è¨€: 'React',
    æ”¯æŒå¹³å°: ['å¾®ä¿¡', 'æ”¯ä»˜å®', 'å­—èŠ‚è·³åŠ¨'],
    å­¦ä¹ æˆæœ¬: 'ä½ï¼ˆReactå¼€å‘è€…ï¼‰',
    æ€§èƒ½: 'ä¼˜ç§€',
    ç‰¹ç‚¹: 'çœŸæ­£çš„Reactå¼€å‘ä½“éªŒ'
  },
  
  'mpvue': {
    å¼€å‘è¯­è¨€: 'Vue.js',
    æ”¯æŒå¹³å°: ['å¾®ä¿¡', 'æ”¯ä»˜å®', 'ç™¾åº¦'],
    çŠ¶æ€: 'å·²åœæ­¢ç»´æŠ¤',
    æ›¿ä»£æ–¹æ¡ˆ: 'uni-app'
  }
};
```

## å¾®ä¿¡å°ç¨‹åºæ·±å…¥å¼€å‘

### å°ç¨‹åºæ¶æ„å’Œç”Ÿå‘½å‘¨æœŸ

```javascript
// 1. å°ç¨‹åºåº”ç”¨ç”Ÿå‘½å‘¨æœŸ
// app.js
App({
  // å°ç¨‹åºåˆå§‹åŒ–å®Œæˆæ—¶è§¦å‘ï¼Œå…¨å±€åªè§¦å‘ä¸€æ¬¡
  onLaunch(options) {
    console.log('å°ç¨‹åºå¯åŠ¨', options);
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    this.getUserInfo();
    
    // æ£€æŸ¥æ›´æ–°
    this.checkForUpdate();
    
    // åˆå§‹åŒ–äº‘å¼€å‘
    if (wx.cloud) {
      wx.cloud.init({
        env: 'your-env-id',
        traceUser: true
      });
    }
  },
  
  // å°ç¨‹åºæ˜¾ç¤º/åˆ‡å‰å°æ—¶è§¦å‘
  onShow(options) {
    console.log('å°ç¨‹åºæ˜¾ç¤º', options);
    
    // æ›´æ–°æ•°æ®
    this.updateAppData();
  },
  
  // å°ç¨‹åºéšè—/åˆ‡åå°æ—¶è§¦å‘
  onHide() {
    console.log('å°ç¨‹åºéšè—');
    
    // ä¿å­˜æ•°æ®
    this.saveAppData();
  },
  
  // å°ç¨‹åºå‘ç”Ÿè„šæœ¬é”™è¯¯æˆ–APIè°ƒç”¨æŠ¥é”™æ—¶è§¦å‘
  onError(msg) {
    console.error('å°ç¨‹åºé”™è¯¯', msg);
    
    // é”™è¯¯ä¸ŠæŠ¥
    this.reportError(msg);
  },
  
  // é¡µé¢ä¸å­˜åœ¨æ—¶è§¦å‘
  onPageNotFound(res) {
    console.log('é¡µé¢ä¸å­˜åœ¨', res);
    
    // é‡å®šå‘åˆ°é¦–é¡µ
    wx.redirectTo({
      url: '/pages/index/index'
    });
  },
  
  // å…¨å±€æ•°æ®
  globalData: {
    userInfo: null,
    systemInfo: null
  },
  
  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserInfo() {
    return new Promise((resolve, reject) => {
      // æ£€æŸ¥æ˜¯å¦å·²æˆæƒ
      wx.getSetting({
        success: (res) => {
          if (res.authSetting['scope.userInfo']) {
            wx.getUserInfo({
              success: (userRes) => {
                this.globalData.userInfo = userRes.userInfo;
                resolve(userRes.userInfo);
              },
              fail: reject
            });
          } else {
            // æœªæˆæƒï¼Œå¼•å¯¼ç”¨æˆ·æˆæƒ
            resolve(null);
          }
        },
        fail: reject
      });
    });
  },
  
  // æ£€æŸ¥å°ç¨‹åºæ›´æ–°
  checkForUpdate() {
    if (wx.canIUse('getUpdateManager')) {
      const updateManager = wx.getUpdateManager();
      
      updateManager.onCheckForUpdate((res) => {
        console.log('æ£€æŸ¥æ›´æ–°ç»“æœ', res.hasUpdate);
      });
      
      updateManager.onUpdateReady(() => {
        wx.showModal({
          title: 'æ›´æ–°æç¤º',
          content: 'æ–°ç‰ˆæœ¬å·²ç»å‡†å¤‡å¥½ï¼Œæ˜¯å¦é‡å¯åº”ç”¨ï¼Ÿ',
          success: (res) => {
            if (res.confirm) {
              updateManager.applyUpdate();
            }
          }
        });
      });
      
      updateManager.onUpdateFailed(() => {
        wx.showToast({
          title: 'æ›´æ–°å¤±è´¥',
          icon: 'none'
        });
      });
    }
  }
});

// 2. é¡µé¢ç”Ÿå‘½å‘¨æœŸ
// pages/index/index.js
Page({
  data: {
    userInfo: {},
    hasUserInfo: false,
    posts: [],
    loading: false
  },
  
  // é¡µé¢åŠ è½½æ—¶è§¦å‘ï¼Œä¸€ä¸ªé¡µé¢åªä¼šè°ƒç”¨ä¸€æ¬¡
  onLoad(options) {
    console.log('é¡µé¢åŠ è½½', options);
    
    // è·å–é¡µé¢å‚æ•°
    this.pageParams = options;
    
    // åˆå§‹åŒ–é¡µé¢æ•°æ®
    this.initPageData();
  },
  
  // é¡µé¢æ˜¾ç¤º/åˆ‡å…¥å‰å°æ—¶è§¦å‘
  onShow() {
    console.log('é¡µé¢æ˜¾ç¤º');
    
    // åˆ·æ–°æ•°æ®
    this.refreshData();
  },
  
  // é¡µé¢éšè—/åˆ‡å…¥åå°æ—¶è§¦å‘
  onHide() {
    console.log('é¡µé¢éšè—');
  },
  
  // é¡µé¢å¸è½½æ—¶è§¦å‘
  onUnload() {
    console.log('é¡µé¢å¸è½½');
    
    // æ¸…ç†å®šæ—¶å™¨
    if (this.timer) {
      clearInterval(this.timer);
    }
  },
  
  // ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åˆ·æ–°äº‹ä»¶
  onPullDownRefresh() {
    console.log('ä¸‹æ‹‰åˆ·æ–°');
    
    this.refreshData().finally(() => {
      wx.stopPullDownRefresh();
    });
  },
  
  // é¡µé¢ä¸Šæ‹‰è§¦åº•äº‹ä»¶
  onReachBottom() {
    console.log('ä¸Šæ‹‰è§¦åº•');
    
    this.loadMoreData();
  },
  
  // ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
  onShareAppMessage() {
    return {
      title: 'åˆ†äº«æ ‡é¢˜',
      path: '/pages/index/index',
      imageUrl: '/images/share.jpg'
    };
  },
  
  // ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«åˆ°æœ‹å‹åœˆ
  onShareTimeline() {
    return {
      title: 'åˆ†äº«åˆ°æœ‹å‹åœˆçš„æ ‡é¢˜',
      query: 'from=timeline',
      imageUrl: '/images/timeline-share.jpg'
    };
  },
  
  // åˆå§‹åŒ–é¡µé¢æ•°æ®
  async initPageData() {
    try {
      this.setData({ loading: true });
      
      // è·å–ç”¨æˆ·ä¿¡æ¯
      const app = getApp();
      if (app.globalData.userInfo) {
        this.setData({
          userInfo: app.globalData.userInfo,
          hasUserInfo: true
        });
      }
      
      // åŠ è½½æ–‡ç« åˆ—è¡¨
      await this.loadPosts();
      
    } catch (error) {
      console.error('åˆå§‹åŒ–å¤±è´¥', error);
      wx.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'none'
      });
    } finally {
      this.setData({ loading: false });
    }
  },
  
  // åŠ è½½æ–‡ç« åˆ—è¡¨
  async loadPosts() {
    try {
      const res = await wx.cloud.callFunction({
        name: 'getPosts',
        data: {
          page: 1,
          limit: 10
        }
      });
      
      this.setData({
        posts: res.result.data
      });
    } catch (error) {
      console.error('åŠ è½½æ–‡ç« å¤±è´¥', error);
    }
  },
  
  // åˆ·æ–°æ•°æ®
  async refreshData() {
    await this.loadPosts();
  },
  
  // åŠ è½½æ›´å¤šæ•°æ®
  async loadMoreData() {
    // å®ç°åˆ†é¡µåŠ è½½é€»è¾‘
  },
  
  // è·å–ç”¨æˆ·ä¿¡æ¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  getUserProfile(e) {
    wx.getUserProfile({
      desc: 'ç”¨äºå®Œå–„ä¼šå‘˜èµ„æ–™',
      success: (res) => {
        this.setData({
          userInfo: res.userInfo,
          hasUserInfo: true
        });
        
        // ä¿å­˜åˆ°å…¨å±€æ•°æ®
        getApp().globalData.userInfo = res.userInfo;
      }
    });
  }
});
```

### å°ç¨‹åºäº‘å¼€å‘

```javascript
// 1. äº‘å‡½æ•°å¼€å‘
// cloudfunctions/getPosts/index.js
const cloud = require('wx-server-sdk');

cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
});

const db = cloud.database();

exports.main = async (event, context) => {
  const { page = 1, limit = 10, category } = event;
  
  try {
    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
    let query = db.collection('posts');
    
    if (category) {
      query = query.where({
        category: category,
        status: 'published'
      });
    } else {
      query = query.where({
        status: 'published'
      });
    }
    
    // åˆ†é¡µæŸ¥è¯¢
    const result = await query
      .orderBy('createdAt', 'desc')
      .skip((page - 1) * limit)
      .limit(limit)
      .get();
    
    // è·å–æ€»æ•°
    const countResult = await query.count();
    
    return {
      code: 0,
      data: result.data,
      total: countResult.total,
      page,
      limit
    };
  } catch (error) {
    console.error('è·å–æ–‡ç« å¤±è´¥', error);
    return {
      code: -1,
      message: 'è·å–æ–‡ç« å¤±è´¥'
    };
  }
};

// 2. äº‘æ•°æ®åº“æ“ä½œ
class CloudDatabase {
  constructor() {
    this.db = wx.cloud.database();
  }
  
  // æ·»åŠ æ–‡æ¡£
  async add(collection, data) {
    try {
      const result = await this.db.collection(collection).add({
        data: {
          ...data,
          createdAt: new Date(),
          updatedAt: new Date()
        }
      });
      
      return {
        success: true,
        id: result._id
      };
    } catch (error) {
      console.error('æ·»åŠ æ–‡æ¡£å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // æŸ¥è¯¢æ–‡æ¡£
  async get(collection, id) {
    try {
      const result = await this.db.collection(collection).doc(id).get();
      return {
        success: true,
        data: result.data
      };
    } catch (error) {
      console.error('æŸ¥è¯¢æ–‡æ¡£å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // æ›´æ–°æ–‡æ¡£
  async update(collection, id, data) {
    try {
      await this.db.collection(collection).doc(id).update({
        data: {
          ...data,
          updatedAt: new Date()
        }
      });
      
      return { success: true };
    } catch (error) {
      console.error('æ›´æ–°æ–‡æ¡£å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // åˆ é™¤æ–‡æ¡£
  async remove(collection, id) {
    try {
      await this.db.collection(collection).doc(id).remove();
      return { success: true };
    } catch (error) {
      console.error('åˆ é™¤æ–‡æ¡£å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // å¤æ‚æŸ¥è¯¢
  async query(collection, conditions = {}) {
    try {
      let query = this.db.collection(collection);
      
      // æ·»åŠ æŸ¥è¯¢æ¡ä»¶
      if (Object.keys(conditions).length > 0) {
        query = query.where(conditions);
      }
      
      const result = await query.get();
      
      return {
        success: true,
        data: result.data
      };
    } catch (error) {
      console.error('æŸ¥è¯¢å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
}

// 3. äº‘å­˜å‚¨æ“ä½œ
class CloudStorage {
  // ä¸Šä¼ æ–‡ä»¶
  async uploadFile(filePath, cloudPath) {
    try {
      const result = await wx.cloud.uploadFile({
        cloudPath,
        filePath
      });
      
      return {
        success: true,
        fileID: result.fileID
      };
    } catch (error) {
      console.error('ä¸Šä¼ æ–‡ä»¶å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // ä¸‹è½½æ–‡ä»¶
  async downloadFile(fileID) {
    try {
      const result = await wx.cloud.downloadFile({
        fileID
      });
      
      return {
        success: true,
        tempFilePath: result.tempFilePath
      };
    } catch (error) {
      console.error('ä¸‹è½½æ–‡ä»¶å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // åˆ é™¤æ–‡ä»¶
  async deleteFile(fileIDs) {
    try {
      const result = await wx.cloud.deleteFile({
        fileList: Array.isArray(fileIDs) ? fileIDs : [fileIDs]
      });
      
      return {
        success: true,
        deleteList: result.fileList
      };
    } catch (error) {
      console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // è·å–ä¸´æ—¶é“¾æ¥
  async getTempFileURL(fileIDs) {
    try {
      const result = await wx.cloud.getTempFileURL({
        fileList: Array.isArray(fileIDs) 
          ? fileIDs.map(id => ({ fileID: id }))
          : [{ fileID: fileIDs }]
      });
      
      return {
        success: true,
        fileList: result.fileList
      };
    } catch (error) {
      console.error('è·å–ä¸´æ—¶é“¾æ¥å¤±è´¥', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const cloudDB = new CloudDatabase();
const cloudStorage = new CloudStorage();

// åœ¨é¡µé¢ä¸­ä½¿ç”¨
Page({
  data: {
    imageUrl: ''
  },
  
  // é€‰æ‹©å¹¶ä¸Šä¼ å›¾ç‰‡
  async chooseAndUploadImage() {
    try {
      // é€‰æ‹©å›¾ç‰‡
      const chooseResult = await wx.chooseImage({
        count: 1,
        sizeType: ['compressed'],
        sourceType: ['album', 'camera']
      });
      
      const tempFilePath = chooseResult.tempFilePaths[0];
      
      // ä¸Šä¼ åˆ°äº‘å­˜å‚¨
      const uploadResult = await cloudStorage.uploadFile(
        tempFilePath,
        `images/${Date.now()}.jpg`
      );
      
      if (uploadResult.success) {
        // è·å–ä¸´æ—¶é“¾æ¥ç”¨äºæ˜¾ç¤º
        const urlResult = await cloudStorage.getTempFileURL(uploadResult.fileID);
        
        if (urlResult.success) {
          this.setData({
            imageUrl: urlResult.fileList[0].tempFileURL
          });
        }
      }
    } catch (error) {
      console.error('ä¸Šä¼ å›¾ç‰‡å¤±è´¥', error);
      wx.showToast({
        title: 'ä¸Šä¼ å¤±è´¥',
        icon: 'none'
      });
    }
  }
});
```

---

<Callout type="success">
å°ç¨‹åºå’Œè·¨ç«¯å¼€å‘ä¸ºå‰ç«¯å¼€å‘è€…æä¾›äº†æ›´å¹¿é˜”çš„åº”ç”¨åœºæ™¯ï¼ŒæŒæ¡è¿™äº›æŠ€æœ¯èƒ½å¤Ÿè®©ä½ çš„åº”ç”¨è¦†ç›–æ›´å¤šå¹³å°å’Œç”¨æˆ·ã€‚
</Callout>
