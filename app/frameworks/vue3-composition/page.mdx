import { Callout } from 'nextra/components'

# 08. Vue3æ·±å…¥å’Œç»„åˆå¼API

## ğŸ“‹ ç›®å½•

- [Vue3æ¶æ„é©æ–°](#vue3æ¶æ„é©æ–°)
- [å“åº”å¼ç³»ç»ŸåŸç†](#å“åº”å¼ç³»ç»ŸåŸç†)
- [Composition APIæ·±å…¥](#composition-apiæ·±å…¥)
- [ç»„ä»¶é€šä¿¡å’ŒçŠ¶æ€ç®¡ç†](#ç»„ä»¶é€šä¿¡å’ŒçŠ¶æ€ç®¡ç†)
- [Vue3æ€§èƒ½ä¼˜åŒ–](#vue3æ€§èƒ½ä¼˜åŒ–)
- [Vue3ç”Ÿæ€ç³»ç»Ÿ](#vue3ç”Ÿæ€ç³»ç»Ÿ)

## Vue3æ¶æ„é©æ–°

<Callout type="info">
[Vue3](https://vuejs.org/)å¸¦æ¥äº†å…¨æ–°çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬[Composition API](https://vuejs.org/guide/extras/composition-api-faq.html)ã€æ›´å¥½çš„[TypeScript](https://www.typescriptlang.org/)æ”¯æŒã€Tree-shakingå‹å¥½çš„è®¾è®¡ç­‰é‡å¤§æ”¹è¿›ã€‚
</Callout>

### Vue3 vs Vue2 æ ¸å¿ƒå·®å¼‚

```javascript
// Vue2 Options API
export default {
  data() {
    return {
      count: 0,
      user: null
    }
  },
  computed: {
    doubleCount() {
      return this.count * 2
    }
  },
  methods: {
    increment() {
      this.count++
    },
    async fetchUser() {
      this.user = await api.getUser()
    }
  },
  mounted() {
    this.fetchUser()
  }
}

// Vue3 Composition API
import { ref, computed, onMounted } from 'vue'

export default {
  setup() {
    const count = ref(0)
    const user = ref(null)
    
    const doubleCount = computed(() => count.value * 2)
    
    const increment = () => {
      count.value++
    }
    
    const fetchUser = async () => {
      user.value = await api.getUser()
    }
    
    onMounted(() => {
      fetchUser()
    })
    
    return {
      count,
      user,
      doubleCount,
      increment,
      fetchUser
    }
  }
}
```

### Vue3æ–°ç‰¹æ€§æ¦‚è§ˆ

```vue
<!-- Vue3 æ–°ç‰¹æ€§ç¤ºä¾‹ -->
<template>
  <!-- 1. Fragment - å¤šä¸ªæ ¹èŠ‚ç‚¹ -->
  <header>å¤´éƒ¨å†…å®¹</header>
  <main>ä¸»è¦å†…å®¹</main>
  <footer>åº•éƒ¨å†…å®¹</footer>
  
  <!-- 2. Teleport - ä¼ é€é—¨ -->
  <Teleport to="body">
    <div class="modal">æ¨¡æ€æ¡†å†…å®¹</div>
  </Teleport>
  
  <!-- 3. Suspense - å¼‚æ­¥ç»„ä»¶ -->
  <Suspense>
    <template #default>
      <AsyncComponent />
    </template>
    <template #fallback>
      <div>åŠ è½½ä¸­...</div>
    </template>
  </Suspense>
</template>

<script setup>
// 4. <script setup> è¯­æ³•ç³–
import { ref, computed, watch, onMounted } from 'vue'
import AsyncComponent from './AsyncComponent.vue'

// å“åº”å¼æ•°æ®
const count = ref(0)
const message = ref('Hello Vue3!')

// è®¡ç®—å±æ€§
const doubleCount = computed(() => count.value * 2)

// ä¾¦å¬å™¨
watch(count, (newVal, oldVal) => {
  console.log(`count changed from ${oldVal} to ${newVal}`)
})

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  console.log('ç»„ä»¶å·²æŒ‚è½½')
})

// æ–¹æ³•
const increment = () => {
  count.value++
}

// è‡ªåŠ¨æš´éœ²ç»™æ¨¡æ¿
defineExpose({
  increment,
  count
})
</script>
```

## å“åº”å¼ç³»ç»ŸåŸç†

### Proxy vs Object.defineProperty

<Callout type="warning">
Vue3ä½¿ç”¨Proxyæ›¿ä»£äº†Vue2çš„Object.definePropertyï¼Œè§£å†³äº†æ•°ç»„å’Œå¯¹è±¡å±æ€§åŠ¨æ€æ·»åŠ çš„å“åº”å¼é—®é¢˜ã€‚
</Callout>

```javascript
// Vue2 å“åº”å¼å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
function defineReactive(obj, key, val) {
  Object.defineProperty(obj, key, {
    get() {
      // ä¾èµ–æ”¶é›†
      if (Dep.target) {
        dep.depend()
      }
      return val
    },
    set(newVal) {
      if (newVal === val) return
      val = newVal
      // é€šçŸ¥æ›´æ–°
      dep.notify()
    }
  })
}

// Vue3 å“åº”å¼å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
function reactive(target) {
  return new Proxy(target, {
    get(target, key, receiver) {
      const result = Reflect.get(target, key, receiver)
      
      // ä¾èµ–æ”¶é›†
      track(target, key)
      
      // å¦‚æœæ˜¯å¯¹è±¡ï¼Œé€’å½’ä»£ç†
      if (typeof result === 'object' && result !== null) {
        return reactive(result)
      }
      
      return result
    },
    
    set(target, key, value, receiver) {
      const oldValue = target[key]
      const result = Reflect.set(target, key, value, receiver)
      
      // è§¦å‘æ›´æ–°
      if (oldValue !== value) {
        trigger(target, key)
      }
      
      return result
    },
    
    deleteProperty(target, key) {
      const hadKey = hasOwn(target, key)
      const result = Reflect.deleteProperty(target, key)
      
      if (result && hadKey) {
        trigger(target, key)
      }
      
      return result
    }
  })
}

// ä¾èµ–æ”¶é›†å’Œè§¦å‘æ›´æ–°
let activeEffect = null
const targetMap = new WeakMap()

function track(target, key) {
  if (!activeEffect) return
  
  let depsMap = targetMap.get(target)
  if (!depsMap) {
    targetMap.set(target, (depsMap = new Map()))
  }
  
  let dep = depsMap.get(key)
  if (!dep) {
    depsMap.set(key, (dep = new Set()))
  }
  
  dep.add(activeEffect)
}

function trigger(target, key) {
  const depsMap = targetMap.get(target)
  if (!depsMap) return
  
  const dep = depsMap.get(key)
  if (dep) {
    dep.forEach(effect => effect())
  }
}

function effect(fn) {
  activeEffect = fn
  fn()
  activeEffect = null
}
```

### å“åº”å¼APIè¯¦è§£

```javascript
// 1. ref - åŸºæœ¬ç±»å‹å“åº”å¼
import { ref, isRef, unref, toRef, toRefs } from 'vue'

const count = ref(0)
const message = ref('hello')

console.log(count.value) // 0
count.value++ // è§¦å‘å“åº”å¼æ›´æ–°

// ref åˆ¤æ–­å’Œè§£åŒ…
console.log(isRef(count)) // true
console.log(unref(count)) // 1ï¼Œç­‰åŒäº count.value

// 2. reactive - å¯¹è±¡å“åº”å¼
import { reactive, isReactive, toRaw, markRaw } from 'vue'

const state = reactive({
  count: 0,
  nested: {
    message: 'hello'
  }
})

// æ·±åº¦å“åº”å¼
state.nested.message = 'world' // è§¦å‘æ›´æ–°

// å“åº”å¼åˆ¤æ–­
console.log(isReactive(state)) // true
console.log(isReactive(state.nested)) // true

// è·å–åŸå§‹å¯¹è±¡
const raw = toRaw(state)
console.log(raw === state) // false

// æ ‡è®°ä¸ºéå“åº”å¼
const nonReactive = markRaw({ foo: 'bar' })
const reactiveObj = reactive({ nonReactive })
console.log(isReactive(reactiveObj.nonReactive)) // false

// 3. computed - è®¡ç®—å±æ€§
import { computed } from 'vue'

const count = ref(1)
const plusOne = computed(() => count.value + 1)

console.log(plusOne.value) // 2
count.value++
console.log(plusOne.value) // 3

// å¯å†™è®¡ç®—å±æ€§
const writableComputed = computed({
  get: () => count.value + 1,
  set: (val) => {
    count.value = val - 1
  }
})

writableComputed.value = 10
console.log(count.value) // 9

// 4. watch å’Œ watchEffect
import { watch, watchEffect } from 'vue'

const state = reactive({ count: 0 })

// ä¾¦å¬å•ä¸ªæº
watch(() => state.count, (newVal, oldVal) => {
  console.log(`count: ${oldVal} -> ${newVal}`)
})

// ä¾¦å¬å¤šä¸ªæº
watch([() => state.count, () => state.name], ([newCount, newName], [oldCount, oldName]) => {
  console.log('å¤šä¸ªå€¼å‘ç”Ÿå˜åŒ–')
})

// ç«‹å³æ‰§è¡Œçš„ä¾¦å¬å™¨
watchEffect(() => {
  console.log(`count is ${state.count}`)
})

// åœæ­¢ä¾¦å¬
const stop = watchEffect(() => {
  console.log('è¿™ä¸ªä¾¦å¬å™¨å¯ä»¥è¢«åœæ­¢')
})

// åœæ­¢ä¾¦å¬
stop()
```

## Composition APIæ·±å…¥

### ç»„åˆå¼å‡½æ•°ï¼ˆComposablesï¼‰

<Callout type="info">
ç»„åˆå¼å‡½æ•°æ˜¯Vue3çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†ç›¸å…³çš„é€»è¾‘ç»„åˆåœ¨ä¸€èµ·ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
</Callout>

```javascript
// 1. useCounter - è®¡æ•°å™¨ç»„åˆå¼å‡½æ•°
import { ref, computed } from 'vue'

export function useCounter(initialValue = 0) {
  const count = ref(initialValue)
  
  const increment = () => count.value++
  const decrement = () => count.value--
  const reset = () => count.value = initialValue
  
  const isEven = computed(() => count.value % 2 === 0)
  const isPositive = computed(() => count.value > 0)
  
  return {
    count: readonly(count), // åªè¯»ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥ä¿®æ”¹
    increment,
    decrement,
    reset,
    isEven,
    isPositive
  }
}

// 2. useFetch - æ•°æ®è·å–ç»„åˆå¼å‡½æ•°
import { ref, watchEffect } from 'vue'

export function useFetch(url) {
  const data = ref(null)
  const error = ref(null)
  const loading = ref(false)
  
  const fetchData = async () => {
    loading.value = true
    error.value = null
    
    try {
      const response = await fetch(url.value || url)
      data.value = await response.json()
    } catch (err) {
      error.value = err
    } finally {
      loading.value = false
    }
  }
  
  // å¦‚æœurlæ˜¯å“åº”å¼çš„ï¼Œè‡ªåŠ¨é‡æ–°è·å–
  if (isRef(url)) {
    watchEffect(fetchData)
  } else {
    fetchData()
  }
  
  return {
    data: readonly(data),
    error: readonly(error),
    loading: readonly(loading),
    refetch: fetchData
  }
}

// 3. useLocalStorage - æœ¬åœ°å­˜å‚¨ç»„åˆå¼å‡½æ•°
import { ref, watch } from 'vue'

export function useLocalStorage(key, defaultValue) {
  const storedValue = localStorage.getItem(key)
  const initialValue = storedValue ? JSON.parse(storedValue) : defaultValue
  
  const value = ref(initialValue)
  
  // ç›‘å¬å€¼çš„å˜åŒ–ï¼ŒåŒæ­¥åˆ°localStorage
  watch(value, (newValue) => {
    localStorage.setItem(key, JSON.stringify(newValue))
  }, { deep: true })
  
  // ç›‘å¬localStorageçš„å˜åŒ–ï¼ˆå…¶ä»–æ ‡ç­¾é¡µä¿®æ”¹ï¼‰
  window.addEventListener('storage', (e) => {
    if (e.key === key && e.newValue) {
      value.value = JSON.parse(e.newValue)
    }
  })
  
  return value
}

// 4. useEventListener - äº‹ä»¶ç›‘å¬ç»„åˆå¼å‡½æ•°
import { onMounted, onUnmounted } from 'vue'

export function useEventListener(target, event, handler, options) {
  onMounted(() => {
    target.addEventListener(event, handler, options)
  })
  
  onUnmounted(() => {
    target.removeEventListener(event, handler, options)
  })
}

// 5. useIntersectionObserver - äº¤å‰è§‚å¯Ÿå™¨ç»„åˆå¼å‡½æ•°
import { ref, onMounted, onUnmounted } from 'vue'

export function useIntersectionObserver(target, options = {}) {
  const isIntersecting = ref(false)
  const entries = ref([])
  
  let observer = null
  
  onMounted(() => {
    observer = new IntersectionObserver((observerEntries) => {
      entries.value = observerEntries
      isIntersecting.value = observerEntries.some(entry => entry.isIntersecting)
    }, options)
    
    if (target.value) {
      observer.observe(target.value)
    }
  })
  
  onUnmounted(() => {
    if (observer) {
      observer.disconnect()
    }
  })
  
  return {
    isIntersecting: readonly(isIntersecting),
    entries: readonly(entries)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
export default {
  setup() {
    // ä½¿ç”¨è®¡æ•°å™¨
    const { count, increment, decrement, isEven } = useCounter(10)
    
    // ä½¿ç”¨æ•°æ®è·å–
    const { data: users, loading, error } = useFetch('/api/users')
    
    // ä½¿ç”¨æœ¬åœ°å­˜å‚¨
    const theme = useLocalStorage('theme', 'light')
    
    // ä½¿ç”¨äº‹ä»¶ç›‘å¬
    useEventListener(window, 'resize', () => {
      console.log('çª—å£å¤§å°æ”¹å˜')
    })
    
    return {
      count,
      increment,
      decrement,
      isEven,
      users,
      loading,
      error,
      theme
    }
  }
}
```

### é«˜çº§ç»„åˆæ¨¡å¼

```javascript
// 1. çŠ¶æ€æœºç»„åˆå¼å‡½æ•°
export function useStateMachine(initialState, transitions) {
  const state = ref(initialState)
  
  const transition = (action) => {
    const currentTransitions = transitions[state.value]
    if (currentTransitions && currentTransitions[action]) {
      state.value = currentTransitions[action]
    }
  }
  
  const can = (action) => {
    const currentTransitions = transitions[state.value]
    return currentTransitions && currentTransitions[action] !== undefined
  }
  
  return {
    state: readonly(state),
    transition,
    can
  }
}

// ä½¿ç”¨çŠ¶æ€æœº
const { state, transition, can } = useStateMachine('idle', {
  idle: { start: 'loading' },
  loading: { success: 'success', error: 'error' },
  success: { reset: 'idle' },
  error: { retry: 'loading', reset: 'idle' }
})

// 2. è¡¨å•éªŒè¯ç»„åˆå¼å‡½æ•°
export function useFormValidation(rules) {
  const errors = ref({})
  const isValid = computed(() => Object.keys(errors.value).length === 0)
  
  const validate = (field, value) => {
    const fieldRules = rules[field]
    if (!fieldRules) return true
    
    for (const rule of fieldRules) {
      const result = rule.validator(value)
      if (!result) {
        errors.value[field] = rule.message
        return false
      }
    }
    
    delete errors.value[field]
    return true
  }
  
  const validateAll = (values) => {
    let allValid = true
    for (const [field, value] of Object.entries(values)) {
      if (!validate(field, value)) {
        allValid = false
      }
    }
    return allValid
  }
  
  const clearErrors = () => {
    errors.value = {}
  }
  
  return {
    errors: readonly(errors),
    isValid,
    validate,
    validateAll,
    clearErrors
  }
}

// 3. æ— é™æ»šåŠ¨ç»„åˆå¼å‡½æ•°
export function useInfiniteScroll(fetchMore, options = {}) {
  const {
    distance = 100,
    disabled = false
  } = options
  
  const loading = ref(false)
  const finished = ref(false)
  
  const checkScroll = () => {
    if (loading.value || finished.value || disabled) return
    
    const { scrollTop, scrollHeight, clientHeight } = document.documentElement
    
    if (scrollTop + clientHeight >= scrollHeight - distance) {
      loading.value = true
      
      fetchMore()
        .then((hasMore) => {
          if (!hasMore) {
            finished.value = true
          }
        })
        .finally(() => {
          loading.value = false
        })
    }
  }
  
  useEventListener(window, 'scroll', checkScroll)
  
  return {
    loading: readonly(loading),
    finished: readonly(finished)
  }
}
```

## ç»„ä»¶é€šä¿¡å’ŒçŠ¶æ€ç®¡ç†

### ç»„ä»¶é€šä¿¡æ–¹å¼

```vue
<!-- 1. Props å’Œ Emits -->
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <ChildComponent 
    :message="parentMessage"
    :count="count"
    @update:count="handleCountUpdate"
    @custom-event="handleCustomEvent"
  />
</template>

<script setup>
import { ref } from 'vue'
import ChildComponent from './ChildComponent.vue'

const parentMessage = ref('æ¥è‡ªçˆ¶ç»„ä»¶çš„æ¶ˆæ¯')
const count = ref(0)

const handleCountUpdate = (newCount) => {
  count.value = newCount
}

const handleCustomEvent = (data) => {
  console.log('æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶:', data)
}
</script>

<!-- å­ç»„ä»¶ -->
<template>
  <div>
    <p>{{ message }}</p>
    <p>Count: {{ count }}</p>
    <button @click="updateCount">æ›´æ–°è®¡æ•°</button>
    <button @click="emitCustomEvent">å‘é€è‡ªå®šä¹‰äº‹ä»¶</button>
  </div>
</template>

<script setup>
import { defineProps, defineEmits } from 'vue'

// å®šä¹‰props
const props = defineProps({
  message: {
    type: String,
    required: true
  },
  count: {
    type: Number,
    default: 0
  }
})

// å®šä¹‰emits
const emit = defineEmits(['update:count', 'custom-event'])

const updateCount = () => {
  emit('update:count', props.count + 1)
}

const emitCustomEvent = () => {
  emit('custom-event', { timestamp: Date.now() })
}
</script>

<!-- 2. Provide/Inject -->
<!-- ç¥–å…ˆç»„ä»¶ -->
<script setup>
import { provide, ref } from 'vue'

const theme = ref('dark')
const user = ref({ name: 'John', role: 'admin' })

// æä¾›æ•°æ®
provide('theme', theme)
provide('user', readonly(user))

// æä¾›æ–¹æ³•
provide('updateTheme', (newTheme) => {
  theme.value = newTheme
})
</script>

<!-- åä»£ç»„ä»¶ -->
<script setup>
import { inject } from 'vue'

// æ³¨å…¥æ•°æ®
const theme = inject('theme')
const user = inject('user')
const updateTheme = inject('updateTheme')

// ä½¿ç”¨é»˜è®¤å€¼
const config = inject('config', { api: '/api' })
</script>

<!-- 3. æ¨¡æ¿å¼•ç”¨ -->
<template>
  <ChildComponent ref="childRef" />
  <button @click="callChildMethod">è°ƒç”¨å­ç»„ä»¶æ–¹æ³•</button>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const childRef = ref()

const callChildMethod = () => {
  childRef.value.someMethod()
}

onMounted(() => {
  console.log(childRef.value) // å­ç»„ä»¶å®ä¾‹
})
</script>
```

### PiniaçŠ¶æ€ç®¡ç†

```javascript
// stores/counter.js
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

// Option Store
export const useCounterStore = defineStore('counter', {
  state: () => ({
    count: 0,
    name: 'Eduardo'
  }),
  
  getters: {
    doubleCount: (state) => state.count * 2,
    doubleCountPlusOne() {
      return this.doubleCount + 1
    }
  },
  
  actions: {
    increment() {
      this.count++
    },
    
    async fetchUserData() {
      const userData = await api.getUser()
      this.name = userData.name
    }
  }
})

// Composition Store
export const useCounterStore = defineStore('counter', () => {
  // state
  const count = ref(0)
  const name = ref('Eduardo')
  
  // getters
  const doubleCount = computed(() => count.value * 2)
  
  // actions
  function increment() {
    count.value++
  }
  
  async function fetchUserData() {
    const userData = await api.getUser()
    name.value = userData.name
  }
  
  return {
    count,
    name,
    doubleCount,
    increment,
    fetchUserData
  }
})

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
<script setup>
import { useCounterStore } from '@/stores/counter'
import { storeToRefs } from 'pinia'

const store = useCounterStore()

// è§£æ„å“åº”å¼æ•°æ®
const { count, name, doubleCount } = storeToRefs(store)

// è§£æ„actionsï¼ˆä¸éœ€è¦storeToRefsï¼‰
const { increment, fetchUserData } = store

// ç›´æ¥ä½¿ç”¨
store.count++
store.$patch({ count: store.count + 1 })
store.$patch((state) => {
  state.count++
  state.name = 'New Name'
})
</script>
```

## Vue3æ€§èƒ½ä¼˜åŒ–

<Callout type="info">
Vue3åœ¨æ€§èƒ½æ–¹é¢æœ‰æ˜¾è‘—æå‡ï¼ŒåŒ…æ‹¬æ›´å°çš„åŒ…ä½“ç§¯ã€æ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦å’Œæ›´å¥½çš„Tree-shakingæ”¯æŒã€‚
</Callout>

### ç¼–è¯‘æ—¶ä¼˜åŒ–

```vue
<template>
  <!-- é™æ€æå‡ - é™æ€å…ƒç´ ä¼šè¢«æå‡åˆ°æ¸²æŸ“å‡½æ•°å¤–éƒ¨ -->
  <div class="static-class">
    <h1>é™æ€æ ‡é¢˜</h1>
    <!-- åŠ¨æ€å†…å®¹ -->
    <p>{{ message }}</p>

    <!-- è¡¥ä¸æ ‡è®° - Vue3ä¼šæ ‡è®°åŠ¨æ€å†…å®¹ -->
    <div :class="dynamicClass">{{ count }}</div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const message = ref('Hello Vue3')
const count = ref(0)
const dynamicClass = computed(() => count.value > 10 ? 'large' : 'small')
</script>
```

### å“åº”å¼ä¼˜åŒ–

```javascript
// ä½¿ç”¨shallowRefå‡å°‘æ·±åº¦å“åº”å¼å¼€é”€
import { shallowRef, triggerRef } from 'vue'

const state = shallowRef({
  count: 0,
  nested: {
    value: 'hello'
  }
})

// æ‰‹åŠ¨è§¦å‘æ›´æ–°
function updateNested() {
  state.value.nested.value = 'world'
  triggerRef(state) // æ‰‹åŠ¨è§¦å‘å“åº”å¼æ›´æ–°
}

// ä½¿ç”¨markRawé¿å…å“åº”å¼è½¬æ¢
import { markRaw, reactive } from 'vue'

const state = reactive({
  foo: markRaw({
    // è¿™ä¸ªå¯¹è±¡ä¸ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
    nestedProperty: 'value'
  })
})
```

### ç»„ä»¶ä¼˜åŒ–

```vue
<!-- ä½¿ç”¨v-memoç¼“å­˜å­æ ‘ -->
<template>
  <div v-for="item in list" :key="item.id" v-memo="[item.id, item.selected]">
    <p>{{ item.name }}</p>
    <p>{{ item.description }}</p>
  </div>
</template>

<script setup>
// ä½¿ç”¨defineAsyncComponentå¼‚æ­¥åŠ è½½ç»„ä»¶
import { defineAsyncComponent } from 'vue'

const AsyncComponent = defineAsyncComponent({
  loader: () => import('./HeavyComponent.vue'),
  loadingComponent: LoadingComponent,
  errorComponent: ErrorComponent,
  delay: 200,
  timeout: 3000
})
</script>
```

## Vue3ç”Ÿæ€ç³»ç»Ÿ

<Callout type="info">
Vue3æ‹¥æœ‰ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬å®˜æ–¹å·¥å…·ã€ç¬¬ä¸‰æ–¹åº“å’Œå¼€å‘å·¥å…·ã€‚
</Callout>

### å®˜æ–¹å·¥å…·é“¾

```bash
# Vite - å®˜æ–¹æ„å»ºå·¥å…·
npm create vue@latest my-vue-app
cd my-vue-app
npm install
npm run dev

# Vue CLI (ä¼ ç»Ÿæ–¹å¼)
npm install -g @vue/cli
vue create my-project
```

### è·¯ç”±ç®¡ç†

```javascript
// Vue Router 4
import { createRouter, createWebHistory } from 'vue-router'
import { defineAsyncComponent } from 'vue'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/',
      name: 'Home',
      component: () => import('./views/Home.vue')
    },
    {
      path: '/about',
      name: 'About',
      component: defineAsyncComponent(() => import('./views/About.vue'))
    },
    {
      path: '/user/:id',
      name: 'User',
      component: () => import('./views/User.vue'),
      props: true
    }
  ]
})

export default router
```

### çŠ¶æ€ç®¡ç†

```javascript
// Pinia - å®˜æ–¹çŠ¶æ€ç®¡ç†åº“
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', {
  state: () => ({
    count: 0,
    name: 'Eduardo'
  }),

  getters: {
    doubleCount: (state) => state.count * 2
  },

  actions: {
    increment() {
      this.count++
    },

    async fetchUserData(userId) {
      try {
        const userData = await api.getUser(userId)
        this.name = userData.name
      } catch (error) {
        console.error('Failed to fetch user:', error)
      }
    }
  }
})

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { useCounterStore } from '@/stores/counter'

const counter = useCounterStore()
counter.increment()
```

### UIç»„ä»¶åº“

```javascript
// Element Plus
import { createApp } from 'vue'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'

const app = createApp(App)
app.use(ElementPlus)

// Ant Design Vue
import { createApp } from 'vue'
import Antd from 'ant-design-vue'
import 'ant-design-vue/dist/antd.css'

const app = createApp(App)
app.use(Antd)

// Vuetify 3
import { createApp } from 'vue'
import { createVuetify } from 'vuetify'
import 'vuetify/styles'

const vuetify = createVuetify()
const app = createApp(App)
app.use(vuetify)
```

### å¼€å‘å·¥å…·

```javascript
// Vue DevTools
// æµè§ˆå™¨æ‰©å±•ï¼Œæ”¯æŒVue3çš„Composition APIè°ƒè¯•

// Volar - VS Codeæ‰©å±•
// æä¾›Vue3å’ŒTypeScriptçš„å®Œæ•´æ”¯æŒ

// æµ‹è¯•å·¥å…·
import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import MyComponent from './MyComponent.vue'

describe('MyComponent', () => {
  it('renders properly', () => {
    const wrapper = mount(MyComponent, {
      props: { msg: 'Hello Vitest' }
    })
    expect(wrapper.text()).toContain('Hello Vitest')
  })
})
```

---

<Callout type="success">
Vue3çš„Composition APIå’Œå“åº”å¼ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†æ›´çµæ´»ã€æ›´å¼ºå¤§çš„å¼€å‘ä½“éªŒã€‚é€šè¿‡åˆç†ä½¿ç”¨ç»„åˆå¼å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæ›´åŠ æ¨¡å—åŒ–å’Œå¯å¤ç”¨çš„ä»£ç ã€‚
</Callout>

---

## ğŸ“š å‚è€ƒå­¦ä¹ èµ„æ–™

### ğŸ“– å®˜æ–¹æ–‡æ¡£
- [Vue3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/) - Vue3æƒå¨å­¦ä¹ èµ„æº
- [Vue3 API å‚è€ƒ](https://vuejs.org/api/) - å®Œæ•´APIæ–‡æ¡£
- [Vue Router 4](https://router.vuejs.org/) - å®˜æ–¹è·¯ç”±ç®¡ç†
- [Pinia](https://pinia.vuejs.org/) - å®˜æ–¹çŠ¶æ€ç®¡ç†åº“

### ğŸ“ ä¼˜è´¨æ•™ç¨‹
- [Vue3 å®˜æ–¹æ•™ç¨‹](https://vuejs.org/tutorial/) - å®˜æ–¹äº¤äº’å¼æ•™ç¨‹
- [Vue Mastery](https://www.vuemastery.com/) - Vueä¸“ä¸šè¯¾ç¨‹å¹³å°
- [Vue School](https://vueschool.io/) - Vueåœ¨çº¿å­¦ä¹ å¹³å°

### ğŸ› ï¸ å®è·µé¡¹ç›®
- [Vue3 ç¤ºä¾‹é¡¹ç›®](https://github.com/vuejs/petite-vue) - å®˜æ–¹ç¤ºä¾‹
- [Awesome Vue](https://github.com/vuejs/awesome-vue) - Vueèµ„æºé›†åˆ
- [Vue3 æœ€ä½³å®è·µ](https://github.com/vuejs/vue-next) - å®˜æ–¹ä»“åº“

### ğŸ”§ å¼€å‘å·¥å…·
- [Vite](https://vitejs.dev/) - å®˜æ–¹æ„å»ºå·¥å…·
- [Vue CLI](https://cli.vuejs.org/) - ä¼ ç»Ÿè„šæ‰‹æ¶å·¥å…·
- [Vue DevTools](https://devtools.vuejs.org/) - å®˜æ–¹è°ƒè¯•å·¥å…·
- [Volar](https://marketplace.visualstudio.com/items?itemName=Vue.volar) - VS Codeæ‰©å±•

### ğŸ“ æ·±å…¥é˜…è¯»
- [Vue3 è®¾è®¡ç†å¿µ](https://vuejs.org/guide/extras/composition-api-faq.html) - Composition APIè®¾è®¡æ€è·¯
- [Vue3 å“åº”å¼åŸç†](https://vuejs.org/guide/extras/reactivity-in-depth.html) - å“åº”å¼ç³»ç»Ÿæ·±å…¥
- [Vue3 æ€§èƒ½ä¼˜åŒ–](https://vuejs.org/guide/best-practices/performance.html) - å®˜æ–¹æ€§èƒ½æŒ‡å—

<Callout type="tip">
ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå»ºè®®ä»å®˜æ–¹æ–‡æ¡£å¼€å§‹ï¼Œé€šè¿‡Viteåˆ›å»ºé¡¹ç›®å®è·µï¼Œç„¶åæ·±å…¥å­¦ä¹ Composition APIå’Œå“åº”å¼ç³»ç»Ÿï¼Œæœ€åäº†è§£Vue3ç”Ÿæ€ç³»ç»Ÿã€‚
</Callout>
