import { Callout } from 'nextra/components'

# 13. æ¡Œé¢åº”ç”¨å¼€å‘

## ğŸ“‹ ç›®å½•

- [æ¡Œé¢åº”ç”¨å¼€å‘æ¦‚è§ˆ](#æ¡Œé¢åº”ç”¨å¼€å‘æ¦‚è§ˆ)
- [Electronæ ¸å¿ƒå¼€å‘](#electronæ ¸å¿ƒå¼€å‘)
- [Tauriç°ä»£åŒ–æ–¹æ¡ˆ](#tauriç°ä»£åŒ–æ–¹æ¡ˆ)
- [å®‰å…¨æ€§å’Œæœ€ä½³å®è·µ](#å®‰å…¨æ€§å’Œæœ€ä½³å®è·µ)
- [æ‰“åŒ…å’Œåˆ†å‘](#æ‰“åŒ…å’Œåˆ†å‘)

## æ¡Œé¢åº”ç”¨å¼€å‘æ¦‚è§ˆ

<Callout type="info">
æ¡Œé¢åº”ç”¨å¼€å‘è®©[Web](https://developer.mozilla.org/en-US/docs/Web)æŠ€æœ¯èƒ½å¤Ÿåˆ›å»ºåŸç”Ÿæ¡Œé¢åº”ç”¨ï¼Œä¸ºå‰ç«¯å¼€å‘è€…æä¾›äº†æ›´å¹¿é˜”çš„åº”ç”¨åœºæ™¯ã€‚
</Callout>

### æ¡Œé¢åº”ç”¨æŠ€æœ¯æ ˆå¯¹æ¯”

| æŠ€æœ¯ | æŠ€æœ¯æ ˆ | åº”ç”¨ä½“ç§¯ | å†…å­˜å ç”¨ | æ€§èƒ½ | å­¦ä¹ æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|------|--------|----------|----------|------|----------|----------|
| **Electron** | Chromium + Node.js | å¤§(~100MB+) | é«˜ | ä¸­ç­‰ | ä½ | å¤æ‚æ¡Œé¢åº”ç”¨ |
| **Tauri** | Rust + WebView | å°(~10MB) | ä½ | é«˜ | ä¸­ç­‰ | è½»é‡çº§é«˜æ€§èƒ½åº”ç”¨ |
| **Flutter** | Flutter + Dart | ä¸­ç­‰(~30MB) | ä¸­ç­‰ | é«˜ | é«˜ | è·¨å¹³å°UIä¸€è‡´æ€§ |
| **.NET MAUI** | .NET + C# | ä¸­ç­‰(~50MB) | ä¸­ç­‰ | é«˜ | ä¸­ç­‰ | ä¼ä¸šçº§Windowsåº”ç”¨ |

### çŸ¥ååº”ç”¨æ¡ˆä¾‹

| æŠ€æœ¯ | çŸ¥ååº”ç”¨ | ç‰¹ç‚¹ |
|------|----------|------|
| **Electron** | VS Code, Discord, Slack, WhatsApp | æˆç†Ÿç”Ÿæ€ï¼ŒåŠŸèƒ½ä¸°å¯Œ |
| **Tauri** | Clash Verge, Pake | è½»é‡é«˜æ•ˆï¼Œå®‰å…¨æ€§å¥½ |
| **Flutter** | Ubuntu Desktop Installer | è·¨å¹³å°UIä¸€è‡´ |
| **.NET MAUI** | Microsoft Store | ä¼ä¸šçº§åº”ç”¨ |

### æŠ€æœ¯é€‰æ‹©æŒ‡å—

| é¡¹ç›®ç‰¹å¾ | æ¨èæŠ€æœ¯ | ç†ç”± |
|----------|----------|------|
| **Webå›¢é˜Ÿ + å¤æ‚åŠŸèƒ½** | Electron | ç”Ÿæ€æˆç†Ÿï¼Œå¼€å‘æ•ˆç‡é«˜ |
| **æ€§èƒ½æ•æ„Ÿ + å°ä½“ç§¯** | Tauri | é«˜æ€§èƒ½ï¼Œèµ„æºå ç”¨å°‘ |
| **è·¨å¹³å°UIä¸€è‡´æ€§** | Flutter Desktop | ç»Ÿä¸€çš„UIæ¡†æ¶ |
| **ä¼ä¸šçº§Windowsåº”ç”¨** | .NET MAUI | å¾®è½¯ç”Ÿæ€æ”¯æŒ |

### å¿«é€Ÿå†³ç­–æµç¨‹

```javascript
// æŠ€æœ¯é€‰æ‹©å†³ç­–
function chooseDesktopTechnology(requirements) {
  const { teamSkills, performance, appSize, complexity } = requirements;

  // WebæŠ€æœ¯æ ˆ + æ€§èƒ½è¦æ±‚é«˜
  if (teamSkills === 'web' && performance === 'high' && appSize === 'small') {
    return 'Tauri';
  }

  // WebæŠ€æœ¯æ ˆ + å¤æ‚åº”ç”¨
  if (teamSkills === 'web' && complexity === 'high') {
    return 'Electron';
  }

  // è·¨å¹³å°UIä¸€è‡´æ€§
  if (requirements.uiConsistency === 'critical') {
    return 'Flutter Desktop';
  }

  // ä¼ä¸šçº§Windowsåº”ç”¨
  if (requirements.platform === 'windows' && requirements.enterprise === true) {
    return '.NET MAUI';
  }

  return 'Electron'; // é»˜è®¤æ¨è
}
```

## Electronæ ¸å¿ƒå¼€å‘

### Electronæ ¸å¿ƒæ¶æ„

```javascript
// 1. ä¸»è¿›ç¨‹ (main.js)
const { app, BrowserWindow, ipcMain } = require('electron');
const path = require('path');

class ElectronApp {
  constructor() {
    this.mainWindow = null;
    this.setupApp();
  }

  setupApp() {
    app.whenReady().then(() => {
      this.createMainWindow();
      this.setupIPC();
    });

    app.on('window-all-closed', () => {
      if (process.platform !== 'darwin') {
        app.quit();
      }
    });
  }

  createMainWindow() {
    this.mainWindow = new BrowserWindow({
      width: 1200,
      height: 800,
      webPreferences: {
        nodeIntegration: false, // å®‰å…¨è€ƒè™‘
        contextIsolation: true, // å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
        preload: path.join(__dirname, 'preload.js')
      }
    });

    // åŠ è½½åº”ç”¨
    const isDev = process.env.NODE_ENV === 'development';
    if (isDev) {
      this.mainWindow.loadURL('http://localhost:3000');
    } else {
      this.mainWindow.loadFile(path.join(__dirname, '../build/index.html'));
    }
  }

  setupIPC() {
    // æ–‡ä»¶æ“ä½œ
    ipcMain.handle('read-file', async (event, filePath) => {
      try {
        const fs = require('fs').promises;
        const content = await fs.readFile(filePath, 'utf8');
        return { success: true, content };
      } catch (error) {
        return { success: false, error: error.message };
      }
    });

    ipcMain.handle('write-file', async (event, filePath, content) => {
      try {
        const fs = require('fs').promises;
        await fs.writeFile(filePath, content, 'utf8');
        return { success: true };
      } catch (error) {
        return { success: false, error: error.message };
      }
    });

    // çª—å£æ§åˆ¶
    ipcMain.handle('window-minimize', () => {
      this.mainWindow.minimize();
    });

    ipcMain.handle('window-close', () => {
      this.mainWindow.close();
    });
  }
}

// å¯åŠ¨åº”ç”¨
new ElectronApp();

// 2. é¢„åŠ è½½è„šæœ¬ (preload.js)
const { contextBridge, ipcRenderer } = require('electron');

// æš´éœ²å®‰å…¨çš„APIåˆ°æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electronAPI', {
  // æ–‡ä»¶æ“ä½œ
  readFile: (filePath) => ipcRenderer.invoke('read-file', filePath),
  writeFile: (filePath, content) => ipcRenderer.invoke('write-file', filePath, content),

  // çª—å£æ§åˆ¶
  minimizeWindow: () => ipcRenderer.invoke('window-minimize'),
  closeWindow: () => ipcRenderer.invoke('window-close')
});

// 3. æ¸²æŸ“è¿›ç¨‹ (Reactç»„ä»¶)
import React, { useState } from 'react';

function App() {
  const [fileContent, setFileContent] = useState('');

  const handleSaveFile = async () => {
    const filePath = '/path/to/file.txt';
    const result = await window.electronAPI.writeFile(filePath, fileContent);

    if (result.success) {
      alert('æ–‡ä»¶ä¿å­˜æˆåŠŸ');
    } else {
      alert(`ä¿å­˜æ–‡ä»¶å¤±è´¥: ${result.error}`);
    }
  };

  return (
    <div className="app">
      <header className="title-bar">
        <div className="title">æˆ‘çš„Electronåº”ç”¨</div>
        <div className="window-controls">
          <button onClick={() => window.electronAPI.minimizeWindow()}>âˆ’</button>
          <button onClick={() => window.electronAPI.closeWindow()}>Ã—</button>
        </div>
      </header>

      <main className="content">
        <textarea
          value={fileContent}
          onChange={(e) => setFileContent(e.target.value)}
          placeholder="åœ¨è¿™é‡Œè¾“å…¥å†…å®¹..."
        />
        <button onClick={handleSaveFile}>ä¿å­˜æ–‡ä»¶</button>
      </main>
    </div>
  );
}

export default App;
```

## Tauriç°ä»£åŒ–æ–¹æ¡ˆ

<Callout type="info">
[Tauri](https://tauri.app/)æ˜¯ä½¿ç”¨Rustæ„å»ºçš„ç°ä»£æ¡Œé¢åº”ç”¨æ¡†æ¶ï¼Œæä¾›æ›´å°çš„åŒ…ä½“ç§¯å’Œæ›´å¥½çš„æ€§èƒ½ã€‚
</Callout>

### Tauriæ ¸å¿ƒç»“æ„

```rust
// src-tauri/src/main.rs
use tauri::Manager;
use serde::{Deserialize, Serialize};

#[derive(Debug, Serialize)]
struct SystemInfo {
    os: String,
    arch: String,
    version: String,
}

// å‘½ä»¤å‡½æ•°
#[tauri::command]
async fn get_system_info() -> Result<SystemInfo, String> {
    let info = SystemInfo {
        os: std::env::consts::OS.to_string(),
        arch: std::env::consts::ARCH.to_string(),
        version: "1.0.0".to_string(),
    };
    Ok(info)
}

#[tauri::command]
async fn save_file(path: String, content: String) -> Result<(), String> {
    std::fs::write(&path, content)
        .map_err(|e| format!("Failed to save file: {}", e))?;
    Ok(())
}

#[tauri::command]
async fn read_file(path: String) -> Result<String, String> {
    std::fs::read_to_string(&path)
        .map_err(|e| format!("Failed to read file: {}", e))
}

fn main() {
    tauri::Builder::default()
        .invoke_handler(tauri::generate_handler![
            get_system_info,
            save_file,
            read_file
        ])
        .setup(|app| {
            let window = app.get_window("main").unwrap();
            window.set_title("Tauri App").unwrap();
            Ok(())
        })
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### å‰ç«¯é›†æˆ

```typescript
// src/lib/tauri.ts
import { invoke } from '@tauri-apps/api/tauri';
import { appWindow } from '@tauri-apps/api/window';

export interface SystemInfo {
  os: string;
  arch: string;
  version: string;
}

export class TauriAPI {
  // ç³»ç»Ÿä¿¡æ¯
  static async getSystemInfo(): Promise<SystemInfo> {
    return await invoke('get_system_info');
  }

  // æ–‡ä»¶æ“ä½œ
  static async saveFile(path: string, content: string): Promise<void> {
    return await invoke('save_file', { path, content });
  }

  static async readFile(path: string): Promise<string> {
    return await invoke('read_file', { path });
  }

  // çª—å£æ“ä½œ
  static async minimizeWindow(): Promise<void> {
    return await appWindow.minimize();
  }

  static async closeWindow(): Promise<void> {
    return await appWindow.close();
  }
}

// React Hook
import { useState, useEffect } from 'react';

export function useTauriAPI() {
  const [systemInfo, setSystemInfo] = useState<SystemInfo | null>(null);

  useEffect(() => {
    TauriAPI.getSystemInfo().then(setSystemInfo);
  }, []);

  const saveFile = async (path: string, content: string) => {
    try {
      await TauriAPI.saveFile(path, content);
      alert('æ–‡ä»¶ä¿å­˜æˆåŠŸ');
    } catch (error) {
      alert('æ–‡ä»¶ä¿å­˜å¤±è´¥');
    }
  };

  return {
    systemInfo,
    saveFile,
    minimizeWindow: TauriAPI.minimizeWindow,
    closeWindow: TauriAPI.closeWindow,
  };
}
```

```jsx
// src/components/TauriApp.jsx
import React, { useState } from 'react';
import { useTauriAPI } from '../lib/tauri';

export function TauriApp() {
  const { systemInfo, saveFile, minimizeWindow, closeWindow } = useTauriAPI();
  const [fileContent, setFileContent] = useState('');

  const handleSaveFile = async () => {
    await saveFile('/path/to/file.txt', fileContent);
  };

  return (
    <div className="tauri-app">
      <header className="app-header">
        <h1>Tauri åº”ç”¨</h1>
        <div className="window-controls">
          <button onClick={minimizeWindow}>æœ€å°åŒ–</button>
          <button onClick={closeWindow}>å…³é—­</button>
        </div>
      </header>

      <main className="app-main">
        {systemInfo && (
          <div>
            <p>æ“ä½œç³»ç»Ÿ: {systemInfo.os}</p>
            <p>æ¶æ„: {systemInfo.arch}</p>
          </div>
        )}

        <textarea
          placeholder="æ–‡ä»¶å†…å®¹"
          value={fileContent}
          onChange={(e) => setFileContent(e.target.value)}
        />
        <button onClick={handleSaveFile}>ä¿å­˜æ–‡ä»¶</button>
      </main>
    </div>
  );
}
```

## å®‰å…¨æ€§å’Œæœ€ä½³å®è·µ

<Callout type="warning">
æ¡Œé¢åº”ç”¨çš„å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œéœ€è¦ä»å¤šä¸ªå±‚é¢è¿›è¡Œé˜²æŠ¤ã€‚
</Callout>

### Electronå®‰å…¨é…ç½®

```javascript
// å®‰å…¨çš„BrowserWindowé…ç½®
const createSecureWindow = () => {
  return new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      nodeIntegration: false,        // ç¦ç”¨Node.jsé›†æˆ
      contextIsolation: true,        // å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
      enableRemoteModule: false,     // ç¦ç”¨remoteæ¨¡å—
      preload: path.join(__dirname, 'preload.js'),
      sandbox: true,                 // å¯ç”¨æ²™ç›’æ¨¡å¼
      webSecurity: true              // å¯ç”¨webå®‰å…¨
    }
  });
};

// å®‰å…¨çš„é¢„åŠ è½½è„šæœ¬
const { contextBridge, ipcRenderer } = require('electron');

const allowedChannels = ['save-file', 'read-file'];

contextBridge.exposeInMainWorld('electronAPI', {
  invoke: (channel, data) => {
    if (allowedChannels.includes(channel)) {
      return ipcRenderer.invoke(channel, data);
    }
    throw new Error(`Channel ${channel} is not allowed`);
  }
});

// è¾“å…¥éªŒè¯
class InputValidator {
  static validateFilePath(filePath) {
    const normalizedPath = path.normalize(filePath);
    const allowedDir = path.resolve('./user-data');

    if (!normalizedPath.startsWith(allowedDir)) {
      throw new Error('Invalid file path');
    }
    return normalizedPath;
  }

  static sanitizeInput(input) {
    return input.replace(/[<>\"'&]/g, '');
  }
}

```

### Tauriå®‰å…¨é…ç½®

```rust
// src-tauri/src/security.rs
use tauri::command;
use std::path::Path;

// å®‰å…¨çš„æ–‡ä»¶æ“ä½œ
#[command]
pub async fn secure_read_file(path: String) -> Result<String, String> {
    // éªŒè¯è·¯å¾„
    let safe_path = validate_file_path(&path)?;

    // è¯»å–æ–‡ä»¶
    std::fs::read_to_string(safe_path)
        .map_err(|e| format!("Failed to read file: {}", e))
}

fn validate_file_path(path: &str) -> Result<std::path::PathBuf, String> {
    let path = Path::new(path);

    // é˜²æ­¢è·¯å¾„éå†
    if path.components().any(|comp| comp == std::path::Component::ParentDir) {
        return Err("Path traversal not allowed".to_string());
    }

    // é™åˆ¶åœ¨ç‰¹å®šç›®å½•
    let allowed_dir = std::env::current_dir()
        .map_err(|_| "Failed to get current directory")?
        .join("user_data");

    let canonical_path = path.canonicalize()
        .map_err(|_| "Invalid path")?;

    if !canonical_path.starts_with(&allowed_dir) {
        return Err("Access denied".to_string());
    }

    Ok(canonical_path)
}
```

## æ‰“åŒ…å’Œåˆ†å‘

<Callout type="info">
æ¡Œé¢åº”ç”¨çš„æ‰“åŒ…å’Œåˆ†å‘éœ€è¦è€ƒè™‘ä¸åŒå¹³å°çš„ç‰¹æ€§å’Œä»£ç ç­¾åã€‚
</Callout>

### Electronåº”ç”¨æ‰“åŒ…

```json
// package.jsoné…ç½®
{
  "name": "my-electron-app",
  "version": "1.0.0",
  "main": "dist/main.js",
  "scripts": {
    "build": "npm run build:renderer && npm run build:main",
    "pack": "electron-builder",
    "pack:win": "electron-builder --win",
    "pack:mac": "electron-builder --mac",
    "pack:linux": "electron-builder --linux"
  },
  "build": {
    "appId": "com.example.myapp",
    "productName": "My Electron App",
    "directories": {
      "output": "dist-packages"
    },
    "files": [
      "dist/**/*",
      "node_modules/**/*",
      "package.json"
    ],
    "win": {
      "target": "nsis",
      "icon": "assets/icon.ico"
    },
    "mac": {
      "target": "dmg",
      "icon": "assets/icon.icns"
    },
    "linux": {
      "target": "AppImage",
      "icon": "assets/icon.png"
    }
  }
}
```

### Tauriåº”ç”¨æ‰“åŒ…

```json
// src-tauri/tauri.conf.json
{
  "package": {
    "productName": "My Tauri App",
    "version": "1.0.0"
  },
  "build": {
    "distDir": "../dist",
    "devPath": "http://localhost:3000",
    "beforeBuildCommand": "npm run build"
  },
  "tauri": {
    "allowlist": {
      "all": false,
      "fs": {
        "readFile": true,
        "writeFile": true
      },
      "dialog": {
        "open": true,
        "save": true
      }
    },
    "bundle": {
      "active": true,
      "targets": "all",
      "identifier": "com.example.myapp",
      "icon": [
        "icons/icon.icns",
        "icons/icon.ico"
      ]
    },
    "windows": [
      {
        "height": 600,
        "resizable": true,
        "title": "My Tauri App",
        "width": 800
      }
    ]
  }
}
```

### æ„å»ºå‘½ä»¤

```bash
# Electronæ„å»º
npm run build
npm run pack

# Tauriæ„å»º
npm run build
cargo tauri build
```

---

<Callout type="success">
æ¡Œé¢åº”ç”¨å¼€å‘ä¸ºWebæŠ€æœ¯æä¾›äº†æ–°çš„åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡åˆç†çš„æŠ€æœ¯é€‰æ‹©å’Œæ¶æ„è®¾è®¡ï¼Œå¯ä»¥åˆ›å»ºå‡ºé«˜è´¨é‡çš„æ¡Œé¢è½¯ä»¶ã€‚
</Callout>

---

## ğŸ“š å‚è€ƒå­¦ä¹ èµ„æ–™

### ğŸ“– å®˜æ–¹æ–‡æ¡£
- [Electron å®˜æ–¹æ–‡æ¡£](https://www.electronjs.org/) - Electronæƒå¨å­¦ä¹ èµ„æº
- [Tauri å®˜æ–¹æ–‡æ¡£](https://tauri.app/) - Tauriç°ä»£æ¡Œé¢åº”ç”¨æ¡†æ¶
- [Electron Builder](https://www.electron.build/) - Electronåº”ç”¨æ‰“åŒ…å·¥å…·

### ğŸ“ ä¼˜è´¨æ•™ç¨‹
- [Electron å®˜æ–¹æ•™ç¨‹](https://www.electronjs.org/docs/latest/tutorial/tutorial-prerequisites) - å®˜æ–¹å…¥é—¨æ•™ç¨‹
- [Tauri æŒ‡å—](https://tauri.app/v1/guides/) - Tauriå¼€å‘æŒ‡å—

### ğŸ› ï¸ å®è·µé¡¹ç›®
- [Electron Apps](https://www.electronjs.org/apps) - Electronåº”ç”¨å±•ç¤º
- [Tauri Examples](https://github.com/tauri-apps/tauri/tree/dev/examples) - Tauriå®˜æ–¹ç¤ºä¾‹

<Callout type="tip">
ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå»ºè®®ä»Electronå¼€å§‹å­¦ä¹ æ¡Œé¢åº”ç”¨å¼€å‘åŸºç¡€ï¼Œç„¶åæ¢ç´¢Tauriç­‰ç°ä»£åŒ–æ–¹æ¡ˆï¼Œé‡ç‚¹å…³æ³¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŒ–ã€‚
</Callout>
